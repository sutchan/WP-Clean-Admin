# WPCleanAdmin 项目 6A 工作流规则文档

## 1. 可审计性（Auditable）

### 1.1 代码结构与文档
- **模块化设计**：项目模块尽量分离开来，每个模块都有自己的文件，文件命名为 class-模块名.php
- **函数级注释**：所有函数都必须包含简洁明了的注释，描述函数的功能、参数和返回值
- **类级注释**：每个类都必须有完整的文档注释，说明类的用途和主要功能
- **版本控制**：所有代码变更必须通过版本控制系统进行管理，提交信息必须清晰描述变更内容
- **翻译管理**：把所有项目界面字符串加入 POT 翻译文件模板，并生成中英文翻译文件 .po

### 1.2 日志与监控
- **错误日志**：关键操作和错误必须记录日志，便于问题排查和审计
- **操作日志**：记录用户的重要操作，便于追踪和审计
- **性能监控**：定期检查和记录系统性能指标

## 2. 可追踪性（Traceable）

### 2.1 功能追踪
- **唯一标识符**：每个主要功能都应有唯一标识符，便于问题追踪和功能定位
- **代码注释**：关键代码块必须有注释说明其用途和实现逻辑
- **问题跟踪**：所有已知问题和修复过程都必须记录在问题跟踪系统中

### 2.2 错误处理
- **错误码**：定义统一的错误码系统，便于错误追踪和处理
- **错误消息**：所有错误消息必须清晰、一致，并已翻译为支持的语言
- **异常处理**：使用异常处理机制捕获和处理可能的错误

## 3. 可用性（Available）

### 3.1 用户体验
- **界面适配**：界面UI必须考虑桌面端和移动端的适配，确保在不同设备上都有良好的用户体验
- **响应速度**：优化代码和数据库查询，确保系统响应迅速
- **用户反馈**：操作结果必须有明确的用户反馈
- **帮助文档**：提供清晰的帮助文档和使用指南

### 3.2 国际化支持
- **多语言支持**：插件必须支持中英文双语，所有界面字符串必须可翻译
- **PO文件管理**：使用专用的PO翻译文件管理系统，确保翻译的一致性和完整性
- **编码规范**：确保所有文本使用UTF-8编码，特别是中文显示

## 4. 可靠性（Reliable）

### 4.1 代码质量
- **WordPress规范**：严格遵循WordPress插件开发规范
- **安全性检查**：定期进行代码安全审查，确保没有安全漏洞
- **兼容性测试**：确保插件兼容多个WordPress版本和主流浏览器
- **依赖管理**：谨慎使用第三方依赖，定期更新和检查依赖安全性

### 4.2 容错机制
- **输入验证**：所有用户输入都必须进行严格验证和清理
- **错误恢复**：关键功能必须有错误恢复机制，确保系统在异常情况下仍能正常运行
- **资源管理**：确保文件、数据库连接等资源正确释放

## 5. 安全性（Secure）

### 5.1 数据安全
- **数据验证**：所有用户输入数据必须进行验证和清理，防止SQL注入、XSS等攻击
- **权限控制**：严格实施权限控制，确保用户只能访问其有权限的功能和数据
- **数据加密**：敏感数据必须进行加密存储和传输

### 5.2 访问控制
- **非ce验证**：所有AJAX请求必须进行nonce验证，防止CSRF攻击
- **权限检查**：关键操作必须进行用户权限检查
- **路径保护**：防止直接访问插件文件，使用WordPress的钩子和函数进行操作

## 6. 自动化（Automated）

### 6.1 构建与部署
- **自动化测试**：建立单元测试和集成测试，确保代码质量
- **构建自动化**：实现自动化构建流程，包括代码检查、测试、打包等
- **部署自动化**：实现自动化部署流程，减少人为错误

### 6.2 维护自动化
- **更新检查**：实现插件自动更新检查功能
- **清理任务**：定期执行系统清理任务，优化性能
- **监控告警**：设置性能和错误监控，及时发现和解决问题

## 7. WordPress插件开发特定规则

### 7.1 文件结构
- **核心文件**：wp-clean-admin.php作为插件主入口文件
- **包含文件**：所有功能类文件放在includes目录下
- **资源文件**：CSS、JavaScript等资源文件放在assets目录下
- **语言文件**：翻译文件放在languages目录下

### 7.2 函数命名
- **前缀约定**：所有自定义函数和类名都必须使用WPCA_或wpca_前缀，防止命名冲突
- **驼峰命名**：类名使用大驼峰命名法，函数使用小驼峰或下划线分隔命名法

### 7.3 常量定义
- **版本常量**：定义WPCA_VERSION常量表示当前插件版本
- **路径常量**：定义WPCA_PLUGIN_DIR、WPCA_PLUGIN_URL等路径常量

### 7.4 钩子使用
- **激活/停用钩子**：使用register_activation_hook和register_deactivation_hook进行插件激活和停用处理
- **动作钩子**：使用add_action添加自定义动作处理函数
- **过滤器钩子**：使用add_filter添加自定义过滤器处理函数

### 7.5 安全实践
- **非ce创建**：使用wp_create_nonce创建安全令牌
- **非ce验证**：使用check_ajax_referer验证AJAX请求的合法性
- **数据清理**：使用WordPress提供的sanitize_*函数清理用户输入
- **权限检查**：使用current_user_can进行用户权限检查

---

以上规则适用于WPCleanAdmin项目的所有开发和维护工作，必须严格遵守以确保项目的质量、安全和可维护性。