# 开发者指南\r\n\r\n## 1. 概述\r\n\r\n### 1.1 文档目的\r\n\r\n本指南旨在帮助开发者快速了解 WP Clean Admin 项目的开发环境、目录结构、编码规范和开发流程，以便能够顺利参与项目开发和贡献代码。\r\n\r\n### 1.2 项目简介\r\n\r\nWP Clean Admin 是一个 WordPress 插件，用于管理和优化 WordPress 后台，提供菜单清理、性能优化、样式定制等功能，帮助用户打造简洁、高效、安全的 WordPress 后台环境。\r\n\r\n### 1.3 技术栈\r\n\r\n| 技术领域 | 技术栈 | 版本要求 |\r\n|----------|--------|----------|\r\n| 核心语言 | PHP | 7.0+ |\r\n| 前端语言 | JavaScript | ES6+ |\r\n| 样式语言 | CSS | 3+ |\r\n| 框架 | WordPress | 5.0+ |\r\n| 构建工具 | Webpack | 5.x |\r\n| 包管理器 | Composer | 2.x |\r\n| 测试框架 | PHPUnit | 9.x |\r\n| 代码规范 | WPCS | 3.x |\r\n\r\n## 2. 开发环境搭建\r\n\r\n### 2.1 本地开发环境\r\n\r\n1. **安装 WordPress**：\r\n   - 推荐使用 Local by Flywheel、XAMPP、WAMP 或 MAMP 搭建本地 WordPress 环境\r\n   - 确保 WordPress 版本符合要求（5.0+）\r\n   - 确保 PHP 版本符合要求（7.0+）\r\n\r\n2. **安装 Git**：\r\n   - 从 [Git 官网](https://git-scm.com/) 下载并安装 Git\r\n   - 配置 Git 用户名和邮箱：\r\n     ```bash\r\n     git config --global user.name "Your Name"\r\n     git config --global user.email "your.email@example.com"\r\n     ```\r\n\r\n3. **克隆仓库**：\r\n   ```bash\r\n   git clone https://github.com/sutchan/WPCleanAdmin.git\r\n   cd WPCleanAdmin\r\n   ```\r\n\r\n4. **安装依赖**：\r\n   ```bash\r\n   # 安装 PHP 依赖\r\n   composer install\r\n   \r\n   # 安装 JavaScript 依赖（如果有）\r\n   npm install\r\n   ```\r\n\r\n5. **配置开发环境**：\r\n   - 将插件目录复制到本地 WordPress 安装的 `wp-content/plugins/` 目录\r\n   - 或创建符号链接：\r\n     ```bash\r\n     ln -s /path/to/WPCleanAdmin /path/to/wordpress/wp-content/plugins/wp-clean-admin\r\n     ```\r\n\r\n6. **激活插件**：\r\n   - 登录 WordPress 后台\r\n   - 进入「插件」→「已安装插件」\r\n   - 找到 WP Clean Admin 插件，点击「激活」\r\n\r\n### 2.2 开发工具\r\n\r\n1. **代码编辑器**：\r\n   - 推荐使用 VS Code，安装以下扩展：\r\n     - PHP Intelephense\r\n     - WordPress Snippets\r\n     - ESLint\r\n     - Prettier\r\n     - GitLens\r\n\r\n2. **调试工具**：\r\n   - Debug Bar（WordPress 插件）\r\n   - Query Monitor（WordPress 插件）\r\n   - Xdebug（PHP 扩展）\r\n\r\n3. **命令行工具**：\r\n   - WP CLI\r\n   - Composer\r\n   - npm/yarn\r\n\r\n## 3. 目录结构\r\n\r\n### 3.1 项目目录结构\r\n\r\n```\r\nwpcleanadmin/\r\n├── assets/                    # 静态资源目录\r\n│   ├── css/                   # CSS 文件\r\n│   └── js/                    # JavaScript 文件\r\n├── includes/                  # 核心功能目录\r\n│   ├── autoload.php           # 自动加载文件\r\n│   ├── class-*.php            # 各个功能类\r\n│   └── wpca-core-functions.php # 核心函数\r\n├── languages/                 # 语言文件目录\r\n├── docs/                      # 项目文档\r\n├── tests/                     # 测试文件\r\n├── vendor/                    # Composer 依赖\r\n├── .gitignore                 # Git 忽略文件\r\n├── composer.json              # Composer 配置\r\n├── package.json               # npm 配置\r\n├── phpcs.xml                  # PHP 代码规范配置\r\n├── webpack.config.js          # Webpack 配置\r\n└── wp-clean-admin.php         # 插件主文件\r\n```\r\n\r\n### 3.2 目录说明\r\n\r\n| 目录/文件 | 说明 |\r\n|----------|------|\r\n| `assets/` | 存放静态资源文件，包括 CSS、JavaScript、图片等 |\r\n| `includes/` | 存放插件核心功能代码，包括类文件和函数文件 |\r\n| `languages/` | 存放多语言文件，包括 .pot、.po 和 .mo 文件 |\r\n| `docs/` | 存放项目文档，包括使用指南、开发指南等 |\r\n| `tests/` | 存放测试文件，包括单元测试和集成测试 |\r\n| `vendor/` | 存放 Composer 依赖包 |\r\n| `wp-clean-admin.php` | 插件主文件，包含插件的元数据和初始化代码 |\r\n| `composer.json` | Composer 配置文件，定义项目依赖和脚本 |\r\n| `package.json` | npm 配置文件，定义前端依赖和构建脚本 |\r\n| `phpcs.xml` | PHP 代码规范配置文件，用于代码检查 |\r\n| `webpack.config.js` | Webpack 配置文件，用于前端资源构建 |\r\n\r\n## 4. 编码规范\r\n\r\n### 4.1 PHP 编码规范\r\n\r\n1. **遵循 WordPress 编码规范**：\r\n   - 使用 4 个空格作为缩进，禁止使用制表符\r\n   - 每行代码长度不超过 120 个字符\r\n   - 使用 `<?php` 标签，禁止使用短标签 `<?`\r\n   - PHP 文件末尾禁止使用闭合标签 `?>`\r\n   - 类名使用 PascalCase，例如 `WPCleanAdmin\Core`\r\n   - 方法名使用 camelCase，例如 `getInstance()`\r\n   - 函数名使用 snake_case，例如 `wpca_get_settings()`\r\n   - 变量名使用 snake_case，例如 `$plugin_settings`\r\n   - 常量名使用全大写字母和下划线，例如 `WPCA_VERSION`\r\n\r\n2. **命名空间**：\r\n   ```php\r\n   namespace WPCleanAdmin;\r\n   \r\n   class Core {\r\n       // 类代码\r\n   }\r\n   ```\r\n\r\n3. **自动加载**：\r\n   - 遵循 PSR-4 自动加载规范\r\n   - 在 `includes/autoload.php` 中定义自动加载规则\r\n\r\n4. **注释规范**：\r\n   - 使用 PHPDoc 注释类、方法和函数\r\n   - 为复杂代码添加行内注释\r\n   - 注释使用中文\r\n\r\n   ```php\r\n   /**\r\n    * 核心类，负责插件的初始化和管理\r\n    *\r\n    * @package WPCleanAdmin\r\n    * @since 1.0.0\r\n    */\r\n   class Core {\r\n       /**\r\n        * 获取单例实例\r\n        *\r\n        * @return Core 单例实例\r\n        * @since 1.0.0\r\n        */\r\n       public static function getInstance() {\r\n           // 方法代码\r\n       }\r\n   }\r\n   ```\r\n\r\n### 4.2 JavaScript 编码规范\r\n\r\n1. **变量声明**：\r\n   - 使用 `const` 或 `let`，禁止使用 `var`\r\n   - 变量名使用 camelCase，例如 `pluginSettings`\r\n\r\n2. **函数声明**：\r\n   - 使用箭头函数或函数表达式\r\n   - 函数名使用 camelCase，例如 `initPlugin()`\r\n\r\n3. **代码风格**：\r\n   - 使用 2 个空格作为缩进\r\n   - 每行代码长度不超过 120 个字符\r\n   - 必须使用分号结束语句\r\n   - 字符串使用单引号 `'`\r\n\r\n4. **注释规范**：\r\n   - 使用 JSDoc 注释函数和类\r\n   - 为复杂代码添加行内注释\r\n   - 注释使用中文\r\n\r\n   ```javascript\r\n   /**\r\n    * 初始化插件\r\n    * @since 1.0.0\r\n    */\r\n   const initPlugin = () => {\r\n       // 初始化代码\r\n   };\r\n   ```\r\n\r\n### 4.3 CSS 编码规范\r\n\r\n1. **命名规范**：\r\n   - 使用 BEM（Block Element Modifier）命名规范\r\n   - 例如：`.wpca-menu__item--active`\r\n\r\n2. **代码风格**：\r\n   - 使用 2 个空格作为缩进\r\n   - 每行代码长度不超过 120 个字符\r\n   - 选择器使用小写字母，单词之间用连字符 `-` 分隔\r\n   - 属性名使用小写字母，单词之间用连字符 `-` 分隔\r\n\r\n3. **注释规范**：\r\n   - 为每个组件添加注释\r\n   - 注释使用中文\r\n\r\n   ```css\r\n   /* 菜单组件 */\r\n   .wpca-menu {\r\n       display: flex;\r\n       flex-direction: column;\r\n   }\r\n   \r\n   /* 菜单项 */\r\n   .wpca-menu__item {\r\n       padding: 10px;\r\n   }\r\n   \r\n   /* 激活状态的菜单项 */\r\n   .wpca-menu__item--active {\r\n       background-color: #007cba;\r\n       color: white;\r\n   }\r\n   ```\r\n\r\n## 5. 开发流程\r\n\r\n### 5.1 分支管理\r\n\r\n1. **分支策略**：\r\n   - **main**：主分支，用于发布稳定版本\r\n   - **develop**：开发分支，用于集成新功能\r\n   - **feature/xxx**：功能分支，用于开发新功能\r\n   - **bugfix/xxx**：修复分支，用于修复 bug\r\n\r\n2. **分支命名规则**：\r\n   - 功能分支：`feature/功能名称`，例如 `feature/menu-cleanup`\r\n   - 修复分支：`bugfix/问题描述`，例如 `bugfix/fix-menu-display`\r\n\r\n### 5.2 开发流程\r\n\r\n1. **创建分支**：\r\n   ```bash\r\n   # 从 develop 分支创建功能分支\r\n   git checkout develop\r\n   git pull origin develop\r\n   git checkout -b feature/功能名称\r\n   ```\r\n\r\n2. **开发代码**：\r\n   - 遵循编码规范\r\n   - 编写测试用例\r\n   - 更新文档\r\n\r\n3. **代码检查**：\r\n   ```bash\r\n   # 运行 PHP 代码规范检查\r\n   composer run phpcs\r\n   \r\n   # 运行 JavaScript 代码规范检查\r\n   npm run eslint\r\n   ```\r\n\r\n4. **运行测试**：\r\n   ```bash\r\n   # 运行 PHP 单元测试\r\n   composer run test\r\n   \r\n   # 运行 JavaScript 测试\r\n   npm run test\r\n   ```\r\n\r\n5. **提交代码**：\r\n   ```bash\r\n   # 添加修改的文件\r\n   git add .\r\n   \r\n   # 提交代码，使用 Conventional Commits 规范\r\n   git commit -m "feat(menu): 添加菜单清理功能"\r\n   ```\r\n\r\n6. **推送分支**：\r\n   ```bash\r\n   git push origin feature/功能名称\r\n   ```\r\n\r\n7. **创建 Pull Request**：\r\n   - 登录 GitHub\r\n   - 进入项目仓库\r\n   - 点击「New Pull Request」\r\n   - 选择源分支和目标分支（通常是 develop）\r\n   - 填写 PR 描述，包括功能说明、修改内容、测试结果等\r\n   - 提交 PR\r\n\r\n### 5.3 提交信息规范\r\n\r\n使用 Conventional Commits 规范，格式为：\r\n\r\n```\r\ntype(scope): description\r\n\r\n[optional body]\r\n\r\n[optional footer(s)]\r\n```\r\n\r\n**类型（type）**：\r\n- `feat`：新功能\r\n- `fix`：bug 修复\r\n- `docs`：文档更新\r\n- `style`：代码风格修改（不影响功能）\r\n- `refactor`：代码重构（不影响功能）\r\n- `test`：测试相关修改\r\n- `chore`：构建过程或辅助工具的变动\r\n\r\n**范围（scope）**：\r\n- 功能模块名称，例如 `menu`、`performance`、`style`\r\n\r\n**描述（description）**：\r\n- 简短描述修改内容，使用祈使句，首字母小写，不使用句号结尾\r\n\r\n**示例**：\r\n```\r\nfeat(menu): 添加菜单可视化管理功能\r\n\r\nfix(performance): 修复后台加载缓慢问题\r\n\r\ndocs(guide): 更新开发者指南\r\n```\r\n\r\n## 6. 测试指南\r\n\r\n### 6.1 测试类型\r\n\r\n1. **单元测试**：\r\n   - 测试单个函数或方法\r\n   - 使用 PHPUnit 进行测试\r\n   - 测试文件存放在 `tests/unit/` 目录\r\n\r\n2. **集成测试**：\r\n   - 测试多个模块之间的交互\r\n   - 使用 PHPUnit 和 WP CLI 进行测试\r\n   - 测试文件存放在 `tests/integration/` 目录\r\n\r\n3. **功能测试**：\r\n   - 测试完整的功能流程\r\n   - 使用 WP CLI 或浏览器自动化测试\r\n   - 测试文件存放在 `tests/functional/` 目录\r\n\r\n### 6.2 运行测试\r\n\r\n1. **运行所有测试**：\r\n   ```bash\r\n   composer run test\r\n   ```\r\n\r\n2. **运行特定类型的测试**：\r\n   ```bash\r\n   # 运行单元测试\r\n   composer run test:unit\r\n   \r\n   # 运行集成测试\r\n   composer run test:integration\r\n   \r\n   # 运行功能测试\r\n   composer run test:functional\r\n   ```\r\n\r\n3. **运行单个测试文件**：\r\n   ```bash\r\n   vendor/bin/phpunit tests/unit/TestCore.php\r\n   ```\r\n\r\n### 6.3 编写测试用例\r\n\r\n1. **单元测试示例**：\r\n   ```php\r\n   <?php\r\n   \r\n   use PHPUnit\Framework\TestCase;\r\n   use WPCleanAdmin\Core;\r\n   \r\n   class TestCore extends TestCase {\r\n       /**\r\n        * 测试单例模式\r\n        */\r\n       public function testSingleton() {\r\n           $instance1 = Core::getInstance();\r\n           $instance2 = Core::getInstance();\r\n           \r\n           $this->assertSame($instance1, $instance2);\r\n       }\r\n       \r\n       /**\r\n        * 测试插件初始化\r\n        */\r\n       public function testInit() {\r\n           $core = Core::getInstance();\r\n           $this->assertTrue($core->init());\r\n       }\r\n   }\r\n   ```\r\n\r\n## 7. 贡献指南\r\n\r\n### 7.1 如何贡献\r\n\r\n1. **Fork 仓库**：\r\n   - 登录 GitHub\r\n   - 进入项目仓库 https://github.com/sutchan/WPCleanAdmin\r\n   - 点击「Fork」按钮，创建自己的 Fork\r\n\r\n2. **克隆 Fork**：\r\n   ```bash\r\n   git clone https://github.com/your-username/WPCleanAdmin.git\r\n   cd WPCleanAdmin\r\n   ```\r\n\r\n3. **添加上游仓库**：\r\n   ```bash\r\n   git remote add upstream https://github.com/sutchan/WPCleanAdmin.git\r\n   ```\r\n\r\n4. **创建分支**：\r\n   ```bash\r\n   git checkout develop\r\n   git pull upstream develop\r\n   git checkout -b feature/功能名称\r\n   ```\r\n\r\n5. **开发代码**：\r\n   - 遵循编码规范\r\n   - 编写测试用例\r\n   - 更新文档\r\n\r\n6. **提交代码**：\r\n   ```bash\r\n   git add .\r\n   git commit -m "feat(menu): 添加菜单清理功能"\r\n   ```\r\n\r\n7. **推送分支**：\r\n   ```bash\r\n   git push origin feature/功能名称\r\n   ```\r\n\r\n8. **创建 Pull Request**：\r\n   - 登录 GitHub\r\n   - 进入你的 Fork 仓库\r\n   - 点击「New Pull Request」\r\n   - 选择源分支和目标分支（通常是 upstream/develop）\r\n   - 填写 PR 描述，包括功能说明、修改内容、测试结果等\r\n   - 提交 PR\r\n\r\n### 7.2 贡献要求\r\n\r\n1. **代码质量**：\r\n   - 遵循项目编码规范\r\n   - 编写清晰、可维护的代码\r\n   - 添加适当的注释\r\n\r\n2. **测试**：\r\n   - 为新功能编写测试用例\r\n   - 确保所有测试通过\r\n   - 提高测试覆盖率\r\n\r\n3. **文档**：\r\n   - 更新相关文档\r\n   - 保持文档与代码同步\r\n\r\n4. **兼容性**：\r\n   - 确保代码兼容 WordPress 5.0+ 和 PHP 7.0+\r\n   - 避免使用过时的 API\r\n\r\n### 7.3 代码审查\r\n\r\n1. **审查流程**：\r\n   - PR 提交后，项目维护者会进行代码审查\r\n   - 审查者可能会提出修改建议\r\n   - 开发者需要根据建议修改代码\r\n   - 修改完成后，重新提交代码\r\n\r\n2. **审查标准**：\r\n   - 代码质量和可读性\r\n   - 功能正确性和完整性\r\n   - 测试覆盖率\r\n   - 兼容性和安全性\r\n   - 文档完整性\r\n\r\n## 8. 多语言支持\r\n\r\n### 8.1 国际化（i18n）\r\n\r\n1. **使用 WordPress 翻译函数**：\r\n   ```php\r\n   // 翻译文本\r\n   __('文本内容', 'wp-clean-admin');\r\n   \r\n   // 翻译并回显文本\r\n   _e('文本内容', 'wp-clean-admin');\r\n   \r\n   // 翻译带上下文的文本\r\n   _x('文本内容', '上下文', 'wp-clean-admin');\r\n   \r\n   // 翻译复数形式\r\n   _n('单数形式', '复数形式', $count, 'wp-clean-admin');\r\n   ```\r\n\r\n2. **更新 POT 文件**：\r\n   ```bash\r\n   # 使用 WP CLI 生成 POT 文件\r\n   wp i18n make-pot . languages/wp-clean-admin.pot --exclude=vendor,docs,tests\r\n   ```\r\n\r\n### 8.2 本地化（l10n）\r\n\r\n1. **创建翻译文件**：\r\n   - 使用 Poedit 或其他翻译工具打开 POT 文件\r\n   - 翻译所有字符串\r\n   - 保存为 `.po` 文件，例如 `languages/wp-clean-admin-zh_CN.po`\r\n   - 生成 `.mo` 文件\r\n\r\n2. **添加新语言支持**：\r\n   - 将翻译文件上传到 `languages/` 目录\r\n   - 在 WordPress 后台设置中切换语言\r\n\r\n## 9. 常见问题\r\n\r\n### 9.1 如何调试插件？\r\n\r\n1. **启用 WordPress 调试模式**：\r\n   在 `wp-config.php` 中添加：\r\n   ```php\r\n   define( 'WP_DEBUG', true );\r\n   define( 'WP_DEBUG_DISPLAY', true );\r\n   define( 'WP_DEBUG_LOG', true );\r\n   ```\r\n\r\n2. **使用调试插件**：\r\n   - Debug Bar\r\n   - Query Monitor\r\n\r\n3. **使用 Xdebug**：\r\n   - 配置 Xdebug\r\n   - 在 VS Code 中设置断点\r\n   - 启动调试\r\n\r\n### 9.2 如何处理数据库操作？\r\n\r\n1. **使用 WordPress 数据库类**：\r\n   ```php\r\n   global $wpdb;\r\n   $results = $wpdb->get_results( $wpdb->prepare( "SELECT * FROM {$wpdb->posts} WHERE post_type = %s", 'post' ) );\r\n   ```\r\n\r\n2. **使用自定义表**：\r\n   ```php\r\n   // 创建自定义表\r\n   function wpca_create_table() {\r\n       global $wpdb;\r\n       $table_name = $wpdb->prefix . 'wpca_settings';\r\n       $charset_collate = $wpdb->get_charset_collate();\r\n       \r\n       $sql = "CREATE TABLE $table_name (\r\n           id mediumint(9) NOT NULL AUTO_INCREMENT,\r\n           name varchar(255) NOT NULL,\r\n           value text NOT NULL,\r\n           PRIMARY KEY  (id)\r\n       ) $charset_collate;";\r\n       \r\n       require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );\r\n       dbDelta( $sql );\r\n   }\r\n   register_activation_hook( __FILE__, 'wpca_create_table' );\r\n   ```\r\n\r\n### 9.3 如何添加新功能模块？\r\n\r\n1. **创建类文件**：\r\n   在 `includes/` 目录下创建新的类文件，例如 `class-wpca-new-feature.php`\r\n\r\n2. **定义类**：\r\n   ```php\r\n   namespace WPCleanAdmin;\r\n   \r\n   class NewFeature {\r\n       // 类代码\r\n   }\r\n   ```\r\n\r\n3. **在自动加载中注册**：\r\n   在 `includes/autoload.php` 中添加自动加载规则\r\n\r\n4. **在主文件中初始化**：\r\n   在 `wp-clean-admin.php` 中初始化新功能类\r\n\r\n## 10. 总结\r\n\r\n本指南涵盖了 WP Clean Admin 项目的开发环境、目录结构、编码规范、开发流程、测试指南和贡献指南，希望能够帮助开发者快速上手项目开发。\r\n\r\n开发过程中，建议开发者：\r\n- 严格遵循编码规范\r\n- 编写测试用例\r\n- 更新文档\r\n- 参与代码审查\r\n- 保持良好的沟通\r\n\r\n通过共同努力，我们可以打造一个高质量、功能完善的 WordPress 后台管理优化插件。\r\n\r\n## 11. 版本历史\r\n\r\n| 版本号 | 更新时间 | 更新内容 | 更新人员 |\r\n|--------|----------|----------|----------|\r\n| 1.0.0 | 2025-11-30 | 初始版本 | Sut |\r\n