# 模块开发指南\r\n\r\n## 1. 概述\r\n\r\n### 1.1 文档目的\r\n\r\n本指南旨在帮助开发者了解 WP Clean Admin 项目的模块化架构，学习如何开发、测试和维护模块，以及如何遵循模块开发的最佳实践，确保模块的质量和可维护性。\r\n\r\n### 1.2 模块化架构\r\n\r\nWP Clean Admin 采用模块化架构设计，将功能拆分为独立的模块，便于开发、测试和维护。模块化架构具有以下优势：\r\n\r\n- **高内聚低耦合**：模块内部功能紧密相关，模块之间依赖关系清晰\r\n- **可扩展性**：便于添加新功能，无需修改现有代码\r\n- **可维护性**：模块独立，便于理解、测试和修改\r\n- **可重用性**：模块可以在不同项目中重用\r\n- **并行开发**：多个开发者可以同时开发不同模块\r\n\r\n### 1.3 模块类型\r\n\r\nWP Clean Admin 支持以下类型的模块：\r\n\r\n1. **核心模块**：提供插件的核心功能，如菜单管理、性能优化等\r\n2. **扩展模块**：扩展核心功能，如自定义样式、高级设置等\r\n3. **集成模块**：与第三方服务或插件集成\r\n4. **工具模块**：提供开发或管理工具\r\n5. **主题模块**：自定义插件的外观和样式\r\n\r\n## 2. 模块架构\r\n\r\n### 2.1 模块结构\r\n\r\n1. **标准模块结构**：\r\n   ```\r\n   includes/\r\n   ├── modules/                  # 模块目录\r\n   │   ├── menu/                 # 菜单模块\r\n   │   │   ├── class-wpca-menu-module.php # 模块主类\r\n   │   │   ├── assets/           # 模块静态资源\r\n   │   │   │   ├── css/          # CSS 文件\r\n   │   │   │   └── js/           # JavaScript 文件\r\n   │   │   └── includes/         # 模块辅助文件\r\n   │   ├── performance/          # 性能优化模块\r\n   │   └── style/                # 样式定制模块\r\n   └── class-wpca-module-manager.php # 模块管理器\r\n   ```\r\n\r\n2. **模块组件**：\r\n   - **模块主类**：负责模块的初始化和管理\r\n   - **静态资源**：CSS、JavaScript、图片等\r\n   - **辅助文件**：工具类、函数等\r\n   - **配置文件**：模块配置和设置\r\n\r\n### 2.2 模块管理器\r\n\r\n1. **模块管理器职责**：\r\n   - 模块的注册和加载\r\n   - 模块的初始化和激活\r\n   - 模块之间的通信和依赖管理\r\n   - 模块的配置和设置\r\n   - 模块的卸载和清理\r\n\r\n2. **模块管理器实现**：\r\n   ```php\r\n   <?php\r\n   namespace WPCleanAdmin;\r\n   \r\n   class ModuleManager {\r\n       /**\r\n        * 已注册的模块\r\n        * @var array\r\n        */\r\n       private $modules = array();\r\n       \r\n       /**\r\n        * 已激活的模块\r\n        * @var array\r\n        */\r\n       private $active_modules = array();\r\n       \r\n       /**\r\n        * 单例实例\r\n        * @var ModuleManager\r\n        */\r\n       private static $instance = null;\r\n       \r\n       /**\r\n        * 获取单例实例\r\n        * @return ModuleManager\r\n        */\r\n       public static function getInstance() {\r\n           if ( null === self::$instance ) {\r\n               self::$instance = new self();\r\n           }\r\n           return self::$instance;\r\n       }\r\n       \r\n       /**\r\n        * 注册模块\r\n        * @param string $module_name 模块名称\r\n        * @param array $module_info 模块信息\r\n        */\r\n       public function registerModule( $module_name, $module_info ) {\r\n           $this->modules[ $module_name ] = $module_info;\r\n       }\r\n       \r\n       /**\r\n        * 激活模块\r\n        * @param string $module_name 模块名称\r\n        */\r\n       public function activateModule( $module_name ) {\r\n           if ( isset( $this->modules[ $module_name ] ) ) {\r\n               // 激活模块\r\n               $module = $this->modules[ $module_name ];\r\n               if ( class_exists( $module['class'] ) ) {\r\n                   $module_instance = new $module['class']();\r\n                   $module_instance->init();\r\n                   $this->active_modules[ $module_name ] = $module_instance;\r\n               }\r\n           }\r\n       }\r\n       \r\n       /**\r\n        * 获取所有模块\r\n        * @return array\r\n        */\r\n       public function getModules() {\r\n           return $this->modules;\r\n       }\r\n       \r\n       /**\r\n        * 获取已激活的模块\r\n        * @return array\r\n        */\r\n       public function getActiveModules() {\r\n           return $this->active_modules;\r\n       }\r\n   }\r\n   ```\r\n\r\n## 3. 模块开发流程\r\n\r\n### 3.1 开发准备\r\n\r\n1. **了解模块化架构**：\r\n   - 熟悉 WP Clean Admin 的模块化架构\r\n   - 了解模块管理器的工作原理\r\n   - 了解模块之间的通信机制\r\n\r\n2. **确定模块需求**：\r\n   - 明确模块的功能和范围\r\n   - 确定模块的依赖关系\r\n   - 设计模块的 API 和接口\r\n\r\n3. **创建模块目录结构**：\r\n   - 创建模块主目录\r\n   - 创建模块主类文件\r\n   - 创建静态资源目录\r\n   - 创建辅助文件目录\r\n\r\n### 3.2 开发流程\r\n\r\n1. **创建模块主类**：\r\n   - 实现模块的基本结构\r\n   - 实现模块的初始化方法\r\n   - 实现模块的核心功能\r\n\r\n2. **注册模块**：\r\n   - 在模块管理器中注册模块\r\n   - 设置模块的元数据和依赖关系\r\n\r\n3. **开发模块功能**：\r\n   - 实现模块的核心功能\r\n   - 添加静态资源\r\n   - 实现模块的配置和设置\r\n\r\n4. **测试模块**：\r\n   - 单元测试\r\n   - 集成测试\r\n   - 功能测试\r\n\r\n5. **调试模块**：\r\n   - 启用调试模式\r\n   - 使用调试工具\r\n   - 记录日志\r\n\r\n6. **发布模块**：\r\n   - 更新模块元数据\r\n   - 更新 CHANGELOG\r\n   - 发布模块\r\n\r\n## 4. 模块开发基础\r\n\r\n### 4.1 模块主类\r\n\r\n1. **模块主类结构**：\r\n   ```php\r\n   <?php\r\n   namespace WPCleanAdmin\Modules\Menu;\r\n   \r\n   class MenuModule {\r\n       /**\r\n        * 模块版本\r\n        * @var string\r\n        */\r\n       const VERSION = '1.0.0';\r\n       \r\n       /**\r\n        * 模块名称\r\n        * @var string\r\n        */\r\n       const NAME = 'menu';\r\n       \r\n       /**\r\n        * 模块实例\r\n        * @var MenuModule\r\n        */\r\n       private static $instance = null;\r\n       \r\n       /**\r\n        * 获取单例实例\r\n        * @return MenuModule\r\n        */\r\n       public static function getInstance() {\r\n           if ( null === self::$instance ) {\r\n               self::$instance = new self();\r\n           }\r\n           return self::$instance;\r\n       }\r\n       \r\n       /**\r\n        * 初始化模块\r\n        */\r\n       public function init() {\r\n           // 注册钩子\r\n           $this->registerHooks();\r\n           \r\n           // 加载静态资源\r\n           $this->loadAssets();\r\n           \r\n           // 初始化功能\r\n           $this->initFeatures();\r\n       }\r\n       \r\n       /**\r\n        * 注册钩子\r\n        */\r\n       private function registerHooks() {\r\n           add_action( 'admin_menu', array( $this, 'addMenuPage' ) );\r\n           add_action( 'admin_init', array( $this, 'registerSettings' ) );\r\n       }\r\n       \r\n       /**\r\n        * 加载静态资源\r\n        */\r\n       private function loadAssets() {\r\n           add_action( 'admin_enqueue_scripts', array( $this, 'enqueueScripts' ) );\r\n       }\r\n       \r\n       /**\r\n        * 初始化功能\r\n        */\r\n       private function initFeatures() {\r\n           // 初始化模块功能\r\n       }\r\n       \r\n       /**\r\n        * 添加菜单页面\r\n        */\r\n       public function addMenuPage() {\r\n           add_submenu_page(\r\n               'wp-clean-admin',\r\n               __( '菜单管理', 'wp-clean-admin' ),\r\n               __( '菜单管理', 'wp-clean-admin' ),\r\n               'manage_options',\r\n               'wpca-menu',\r\n               array( $this, 'renderMenuPage' )\r\n           );\r\n       }\r\n       \r\n       /**\r\n        * 渲染菜单页面\r\n        */\r\n       public function renderMenuPage() {\r\n           // 渲染菜单页面\r\n       }\r\n       \r\n       /**\r\n        * 注册设置\r\n        */\r\n       public function registerSettings() {\r\n           // 注册模块设置\r\n       }\r\n       \r\n       /**\r\n        * 加载脚本和样式\r\n        */\r\n       public function enqueueScripts() {\r\n           // 加载模块脚本和样式\r\n       }\r\n   }\r\n   ```\r\n\r\n2. **模块注册**：\r\n   ```php\r\n   // 在插件主文件中注册模块\r\n   function wpca_register_modules() {\r\n       $module_manager = ModuleManager::getInstance();\r\n       \r\n       // 注册菜单模块\r\n       $module_manager->registerModule( 'menu', array(\r\n           'name' => __( '菜单管理', 'wp-clean-admin' ),\r\n           'description' => __( '管理和清理 WordPress 后台菜单', 'wp-clean-admin' ),\r\n           'class' => 'WPCleanAdmin\Modules\Menu\MenuModule',\r\n           'version' => WPCleanAdmin\Modules\Menu\MenuModule::VERSION,\r\n           'dependencies' => array(),\r\n           'enabled' => true\r\n       ) );\r\n       \r\n       // 注册其他模块\r\n   }\r\n   add_action( 'wpca_before_init', 'wpca_register_modules' );\r\n   ```\r\n\r\n### 4.2 模块配置\r\n\r\n1. **模块设置**：\r\n   ```php\r\n   /**\r\n    * 注册模块设置\r\n    */\r\n   public function registerSettings() {\r\n       register_setting( 'wpca_menu_settings', 'wpca_menu_settings' );\r\n       \r\n       add_settings_section(\r\n           'wpca_menu_general',\r\n           __( '常规设置', 'wp-clean-admin' ),\r\n           array( $this, 'renderGeneralSection' ),\r\n           'wpca-menu'\r\n       );\r\n       \r\n       add_settings_field(\r\n           'wpca_menu_enabled',\r\n           __( '启用菜单管理', 'wp-clean-admin' ),\r\n           array( $this, 'renderEnabledField' ),\r\n           'wpca-menu',\r\n           'wpca_menu_general'\r\n       );\r\n   }\r\n   \r\n   /**\r\n    * 渲染常规设置部分\r\n    */\r\n   public function renderGeneralSection() {\r\n       echo __( '配置菜单管理的常规设置', 'wp-clean-admin' );\r\n   }\r\n   \r\n   /**\r\n    * 渲染启用字段\r\n    */\r\n   public function renderEnabledField() {\r\n       $settings = get_option( 'wpca_menu_settings', array() );\r\n       $enabled = isset( $settings['enabled'] ) ? $settings['enabled'] : true;\r\n       \r\n       echo '<input type="checkbox" name="wpca_menu_settings[enabled]" value="1" ' . checked( $enabled, true, false ) . ' />';\r\n   }\r\n   ```\r\n\r\n2. **获取模块设置**：\r\n   ```php\r\n   /**\r\n    * 获取模块设置\r\n    * @return array\r\n    */\r\n   public function getSettings() {\r\n       $default_settings = array(\r\n           'enabled' => true,\r\n           'menu_items' => array()\r\n       );\r\n       \r\n       $settings = get_option( 'wpca_menu_settings', array() );\r\n       return wp_parse_args( $settings, $default_settings );\r\n   }\r\n   ```\r\n\r\n### 4.3 模块通信\r\n\r\n1. **使用钩子系统**：\r\n   ```php\r\n   // 在模块中定义钩子\r\n   do_action( 'wpca_menu_after_save', $menu_items );\r\n   \r\n   // 在其他模块中监听钩子\r\n   add_action( 'wpca_menu_after_save', 'other_module_handle_menu_save' );\r\n   function other_module_handle_menu_save( $menu_items ) {\r\n       // 处理菜单保存事件\r\n   }\r\n   ```\r\n\r\n2. **使用过滤器**：\r\n   ```php\r\n   // 在模块中使用过滤器\r\n   $filtered_items = apply_filters( 'wpca_menu_items', $menu_items );\r\n   \r\n   // 在其他模块中添加过滤器\r\n   add_filter( 'wpca_menu_items', 'other_module_modify_menu_items' );\r\n   function other_module_modify_menu_items( $menu_items ) {\r\n       // 修改菜单项目\r\n       $menu_items['new-item'] = array(\r\n           'name' => __( '新项目', 'wp-clean-admin' ),\r\n           'slug' => 'new-item'\r\n       );\r\n       return $menu_items;\r\n   }\r\n   ```\r\n\r\n3. **直接调用模块方法**：\r\n   ```php\r\n   // 获取模块实例\r\n   $module_manager = ModuleManager::getInstance();\r\n   $menu_module = $module_manager->getActiveModules()['menu'];\r\n   \r\n   // 调用模块方法\r\n   $menu_items = $menu_module->getMenuItems();\r\n   ```\r\n\r\n## 4. 模块开发进阶\r\n\r\n### 4.1 模块依赖管理\r\n\r\n1. **声明模块依赖**：\r\n   ```php\r\n   // 注册带有依赖的模块\r\n   $module_manager->registerModule( 'advanced-menu', array(\r\n       'name' => __( '高级菜单管理', 'wp-clean-admin' ),\r\n       'description' => __( '高级菜单管理功能', 'wp-clean-admin' ),\r\n       'class' => 'WPCleanAdmin\Modules\AdvancedMenu\AdvancedMenuModule',\r\n       'version' => '1.0.0',\r\n       'dependencies' => array( 'menu' ), // 依赖菜单模块\r\n       'enabled' => true\r\n   ) );\r\n   ```\r\n\r\n2. **检查模块依赖**：\r\n   ```php\r\n   /**\r\n    * 检查模块依赖\r\n    * @param string $module_name 模块名称\r\n    * @return bool\r\n    */\r\n   public function checkDependencies( $module_name ) {\r\n       if ( ! isset( $this->modules[ $module_name ] ) ) {\r\n           return false;\r\n       }\r\n       \r\n       $module = $this->modules[ $module_name ];\r\n       $dependencies = isset( $module['dependencies'] ) ? $module['dependencies'] : array();\r\n       \r\n       foreach ( $dependencies as $dependency ) {\r\n           if ( ! isset( $this->modules[ $dependency ] ) || ! isset( $this->active_modules[ $dependency ] ) ) {\r\n               return false;\r\n           }\r\n       }\r\n       \r\n       return true;\r\n   }\r\n   ```\r\n\r\n### 4.2 模块国际化\r\n\r\n1. **加载语言文件**：\r\n   ```php\r\n   /**\r\n    * 加载语言文件\r\n    */\r\n   private function loadTextdomain() {\r\n       load_plugin_textdomain( 'wp-clean-admin', false, dirname( plugin_basename( WPCA_PLUGIN_FILE ) ) . '/languages/' );\r\n   }\r\n   ```\r\n\r\n2. **使用翻译函数**：\r\n   ```php\r\n   // 翻译文本\r\n   $text = __( '菜单管理', 'wp-clean-admin' );\r\n   \r\n   // 翻译并回显文本\r\n   _e( '菜单管理', 'wp-clean-admin' );\r\n   \r\n   // 翻译带上下文的文本\r\n   $context_text = _x( '菜单', '上下文描述', 'wp-clean-admin' );\r\n   \r\n   // 翻译复数形式\r\n   $plural_text = _n( '菜单项', '菜单项', $count, 'wp-clean-admin' );\r\n   ```\r\n\r\n### 4.3 模块 REST API\r\n\r\n1. **注册 REST API 端点**：\r\n   ```php\r\n   /**\r\n    * 注册 REST API 端点\r\n    */\r\n   private function registerRestRoutes() {\r\n       register_rest_route( 'wpca/v1', '/menu/items', array(\r\n           'methods' => 'GET',\r\n           'callback' => array( $this, 'getMenuItemsApi' ),\r\n           'permission_callback' => function() {\r\n               return current_user_can( 'manage_options' );\r\n           }\r\n       ) );\r\n       \r\n       register_rest_route( 'wpca/v1', '/menu/items', array(\r\n           'methods' => 'POST',\r\n           'callback' => array( $this, 'saveMenuItemsApi' ),\r\n           'permission_callback' => function() {\r\n               return current_user_can( 'manage_options' );\r\n           }\r\n       ) );\r\n   }\r\n   ```\r\n\r\n2. **实现 API 回调**：\r\n   ```php\r\n   /**\r\n    * 获取菜单项目 API\r\n    */\r\n   public function getMenuItemsApi( $request ) {\r\n       $menu_items = $this->getMenuItems();\r\n       return rest_ensure_response( $menu_items );\r\n   }\r\n   \r\n   /**\r\n    * 保存菜单项目 API\r\n    */\r\n   public function saveMenuItemsApi( $request ) {\r\n       $data = $request->get_json_params();\r\n       $this->saveMenuItems( $data );\r\n       return rest_ensure_response( array( 'success' => true ) );\r\n   }\r\n   ```\r\n\r\n### 4.4 模块升级\r\n\r\n1. **版本管理**：\r\n   ```php\r\n   /**\r\n    * 检查模块升级\r\n    */\r\n   public function checkUpgrade() {\r\n       $current_version = get_option( 'wpca_menu_version', '0.0.0' );\r\n       \r\n       // 如果版本不同，执行升级\r\n       if ( version_compare( $current_version, self::VERSION, '<' ) ) {\r\n           $this->upgrade( $current_version );\r\n           // 更新版本号\r\n           update_option( 'wpca_menu_version', self::VERSION );\r\n       }\r\n   }\r\n   \r\n   /**\r\n    * 执行模块升级\r\n    * @param string $from_version 旧版本\r\n    */\r\n   private function upgrade( $from_version ) {\r\n       // 根据版本执行不同的升级操作\r\n       if ( version_compare( $from_version, '1.0.0', '<' ) ) {\r\n           // 升级到 1.0.0 版本\r\n           $this->upgradeTo100();\r\n       }\r\n       \r\n       if ( version_compare( $from_version, '1.1.0', '<' ) ) {\r\n           // 升级到 1.1.0 版本\r\n           $this->upgradeTo110();\r\n       }\r\n   }\r\n   \r\n   /**\r\n    * 升级到 1.0.0 版本\r\n    */\r\n   private function upgradeTo100() {\r\n       // 执行 1.0.0 版本的升级操作\r\n   }\r\n   \r\n   /**\r\n    * 升级到 1.1.0 版本\r\n    */\r\n   private function upgradeTo110() {\r\n       // 执行 1.1.0 版本的升级操作\r\n   }\r\n   ```\r\n\r\n2. **调用升级检查**：\r\n   ```php\r\n   // 在模块初始化时检查升级\r\n   public function init() {\r\n       // 检查升级\r\n       $this->checkUpgrade();\r\n       \r\n       // 其他初始化操作\r\n   }\r\n   ```\r\n\r\n## 5. 模块测试与调试\r\n\r\n### 5.1 测试方法\r\n\r\n1. **单元测试**：\r\n   ```php\r\n   <?php\r\n   \r\n   use PHPUnit\Framework\TestCase;\r\n   use WPCleanAdmin\Modules\Menu\MenuModule;\r\n   \r\n   class TestMenuModule extends TestCase {\r\n       /**\r\n        * 测试模块初始化\r\n        */\r\n       public function testInit() {\r\n           $menu_module = MenuModule::getInstance();\r\n           $this->assertInstanceOf( MenuModule::class, $menu_module );\r\n           \r\n           // 测试模块初始化\r\n           $menu_module->init();\r\n           $this->assertTrue( true ); // 初始化没有抛出异常\r\n       }\r\n       \r\n       /**\r\n        * 测试获取菜单项目\r\n        */\r\n       public function testGetMenuItems() {\r\n           $menu_module = MenuModule::getInstance();\r\n           $menu_items = $menu_module->getMenuItems();\r\n           $this->assertIsArray( $menu_items );\r\n       }\r\n   }\r\n   ```\r\n\r\n2. **集成测试**：\r\n   ```php\r\n   <?php\r\n   \r\n   use PHPUnit\Framework\TestCase;\r\n   use WPCleanAdmin\ModuleManager;\r\n   use WPCleanAdmin\Modules\Menu\MenuModule;\r\n   \r\n   class TestModuleIntegration extends TestCase {\r\n       /**\r\n        * 测试模块注册和激活\r\n        */\r\n       public function testModuleRegistration() {\r\n           $module_manager = ModuleManager::getInstance();\r\n           \r\n           // 注册模块\r\n           $module_manager->registerModule( 'menu', array(\r\n               'name' => '菜单管理',\r\n               'class' => MenuModule::class,\r\n               'enabled' => true\r\n           ) );\r\n           \r\n           // 激活模块\r\n           $module_manager->activateModule( 'menu' );\r\n           \r\n           // 检查模块是否激活\r\n           $active_modules = $module_manager->getActiveModules();\r\n           $this->assertArrayHasKey( 'menu', $active_modules );\r\n           $this->assertInstanceOf( MenuModule::class, $active_modules['menu'] );\r\n       }\r\n   }\r\n   ```\r\n\r\n3. **功能测试**：\r\n   - 在本地开发环境中测试模块功能\r\n   - 测试模块的核心功能\r\n   - 测试模块的边界情况\r\n   - 测试模块的错误处理\r\n\r\n### 5.2 调试技巧\r\n\r\n1. **启用调试模式**：\r\n   ```php\r\n   // 在 wp-config.php 中添加\r\n   define( 'WP_DEBUG', true );\r\n   define( 'WP_DEBUG_DISPLAY', true );\r\n   define( 'WP_DEBUG_LOG', true );\r\n   ```\r\n\r\n2. **使用调试工具**：\r\n   - Debug Bar\r\n   - Query Monitor\r\n   - Xdebug\r\n\r\n3. **日志记录**：\r\n   ```php\r\n   // 记录模块日志\r\n   error_log( 'WP Clean Admin Menu Module: ' . $message );\r\n   \r\n   // 使用 WordPress 调试日志\r\n   if ( defined( 'WP_DEBUG_LOG' ) && WP_DEBUG_LOG ) {\r\n       error_log( 'WP Clean Admin Menu Module Debug: ' . $debug_message );\r\n   }\r\n   ```\r\n\r\n4. **使用 var_dump 和 print_r**：\r\n   ```php\r\n   // 调试变量\r\n   var_dump( $menu_items );\r\n   print_r( $settings );\r\n   \r\n   // 在 WordPress 后台输出调试信息\r\n   add_action( 'admin_notices', function() {\r\n       echo '<div class="notice notice-debug"><p>' . esc_html( $debug_message ) . '</p></div>';\r\n   } );\r\n   ```\r\n\r\n## 6. 模块发布与维护\r\n\r\n### 6.1 准备发布\r\n\r\n1. **更新模块元数据**：\r\n   - 检查模块版本号\r\n   - 更新模块描述\r\n   - 更新作者信息\r\n   - 更新依赖关系\r\n\r\n2. **更新 CHANGELOG**：\r\n   ```markdown\r\n   # Changelog\r\n   \r\n   ## 1.0.0 (2025-11-30)\r\n   - 初始版本\r\n   - 添加菜单管理功能\r\n   - 支持菜单清理和定制\r\n   \r\n   ## 1.1.0 (2025-12-15)\r\n   - 添加高级菜单设置\r\n   - 支持按角色管理菜单\r\n   - 优化菜单加载性能\r\n   ```\r\n\r\n3. **测试模块**：\r\n   - 运行所有测试\r\n   - 测试模块的兼容性\r\n   - 测试模块的性能\r\n\r\n### 6.2 发布流程\r\n\r\n1. **提交代码**：\r\n   ```bash\r\n   # 提交代码\r\n   git add .\r\n   git commit -m "feat(menu): 添加高级菜单功能"\r\n   git push origin feature/advanced-menu\r\n   ```\r\n\r\n2. **创建 Pull Request**：\r\n   - 登录 GitHub\r\n   - 进入项目仓库\r\n   - 点击「New Pull Request」\r\n   - 选择源分支和目标分支\r\n   - 填写 PR 描述\r\n   - 提交 PR\r\n\r\n3. **代码审查**：\r\n   - 等待代码审查\r\n   - 根据审查意见修改代码\r\n   - 重新提交代码\r\n\r\n4. **合并代码**：\r\n   - 代码审查通过后，合并到主分支\r\n   - 标记版本标签\r\n   - 发布新版本\r\n\r\n### 6.3 模块维护\r\n\r\n1. **定期更新**：\r\n   - 修复 bug\r\n   - 添加新功能\r\n   - 优化性能\r\n   - 提高兼容性\r\n\r\n2. **收集反馈**：\r\n   - 监听用户反馈\r\n   - 处理 bug 报告\r\n   - 考虑用户建议\r\n\r\n3. **文档维护**：\r\n   - 更新模块文档\r\n   - 提供使用示例\r\n   - 编写教程和指南\r\n\r\n4. **社区支持**：\r\n   - 回答用户问题\r\n   - 参与社区讨论\r\n   - 分享知识和经验\r\n\r\n## 7. 最佳实践\r\n\r\n### 7.1 编码规范\r\n\r\n1. **遵循 WordPress 编码规范**：\r\n   - 使用 4 个空格作为缩进\r\n   - 每行代码长度不超过 120 个字符\r\n   - 使用 `<?php` 标签，禁止使用短标签 `<?`\r\n   - PHP 文件末尾禁止使用闭合标签 `?>`\r\n\r\n2. **使用命名空间**：\r\n   ```php\r\n   namespace WPCleanAdmin\Modules\Menu;\r\n   \r\n   class MenuModule {\r\n       // 类代码\r\n   }\r\n   ```\r\n\r\n3. **添加注释**：\r\n   - 使用 PHPDoc 注释类、方法和函数\r\n   - 为复杂代码添加行内注释\r\n   - 注释使用中文\r\n\r\n4. **使用单例模式**：\r\n   ```php\r\n   class MenuModule {\r\n       private static $instance = null;\r\n       \r\n       public static function getInstance() {\r\n           if ( null === self::$instance ) {\r\n               self::$instance = new self();\r\n           }\r\n           return self::$instance;\r\n       }\r\n       \r\n       private function __construct() {\r\n           // 私有构造函数\r\n       }\r\n   }\r\n   ```\r\n\r\n### 7.2 模块设计原则\r\n\r\n1. **单一职责原则**：\r\n   - 每个模块只负责一个功能领域\r\n   - 模块内部功能紧密相关\r\n\r\n2. **依赖倒置原则**：\r\n   - 依赖抽象而非具体实现\r\n   - 使用接口定义模块之间的通信\r\n\r\n3. **开闭原则**：\r\n   - 对扩展开放，对修改关闭\r\n   - 便于添加新功能，无需修改现有代码\r\n\r\n4. **接口隔离原则**：\r\n   - 模块接口应该小而专一\r\n   - 避免不必要的依赖\r\n\r\n5. **迪米特法则**：\r\n   - 模块只与直接依赖的模块通信\r\n   - 减少模块之间的耦合\r\n\r\n### 7.3 性能优化\r\n\r\n1. **懒加载**：\r\n   - 只在需要时加载模块\r\n   - 延迟加载资源\r\n\r\n2. **缓存**：\r\n   - 使用对象缓存存储频繁访问的数据\r\n   - 缓存计算结果\r\n\r\n3. **优化资源加载**：\r\n   - 只在需要时加载脚本和样式\r\n   - 压缩脚本和样式文件\r\n   - 使用异步加载和延迟加载\r\n\r\n4. **优化数据库查询**：\r\n   - 减少数据库查询次数\r\n   - 使用索引加速查询\r\n   - 缓存查询结果\r\n\r\n### 7.4 安全性\r\n\r\n1. **输入验证和过滤**：\r\n   - 验证所有用户输入\r\n   - 使用 WordPress 内置验证函数\r\n   - 过滤所有输出到页面的内容\r\n\r\n2. **权限检查**：\r\n   - 验证用户权限\r\n   - 使用 WordPress 内置权限函数\r\n   - 为所有管理操作添加权限检查\r\n\r\n3. **防止 SQL 注入**：\r\n   - 使用预处理语句\r\n   - 避免直接拼接 SQL 语句\r\n   - 使用 WordPress 数据库类\r\n\r\n4. **防止 CSRF 攻击**：\r\n   - 使用 Nonce 验证\r\n   - 为所有表单添加 Nonce\r\n   - 验证 AJAX 请求的 Nonce\r\n\r\n## 8. 总结\r\n\r\n模块化开发是 WP Clean Admin 项目的核心设计理念，通过模块化架构，可以提高代码的可维护性、可扩展性和可重用性。本指南介绍了模块开发的各个方面，包括模块架构、开发流程、基础开发、进阶开发、测试与调试、发布与维护以及最佳实践。\r\n\r\n通过遵循本指南中的最佳实践和规范，开发者可以开发出高质量、可维护的模块，为 WP Clean Admin 项目做出贡献。模块化开发不仅可以提高开发效率，还可以提高代码质量，减少 bug，增强系统的可靠性和可扩展性。\r\n\r\n## 9. 版本历史\r\n\r\n| 版本号 | 更新时间 | 更新内容 | 更新人员 |\r\n|--------|----------|----------|----------|\r\n| 1.0.0 | 2025-11-30 | 初始版本 | Sut |\r\n