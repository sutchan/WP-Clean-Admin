# WP Clean Admin 核心函数参考

## 目录

- [1. 概述](#1-概述)
- [2. 设置管理函数](#2-设置管理函数)
- [3. 用户权限函数](#3-用户权限函数)
- [4. URL 和路径函数](#4-url-和路径函数)
- [5. 后台界面函数](#5-后台界面函数)
- [6. 插件信息函数](#6-插件信息函数)
- [7. 工具函数](#7-工具函数)
- [8. 常量](#8-常量)
- [9. 钩子](#9-钩子)
- [10. 总结](#10-总结)

## 1. 概述
WP Clean Admin 插件提供了一系列核心函数，用于管理插件设置、处理用户权限、生成URL等，方便开发者扩展和定制插件功能。
## 2. 设置管理函数
### 2.1 wpca_get_settings

**功能**：获取插件设置
**参数**：
- `$key` (string)：可选，设置键名，用于获取特定设置
- `$default` (mixed)：可选，默认值，当设置不存在时返回
**返回值**：
- (mixed)：获取到的设置值
**使用示例**：
```php
// 获取所有设置
$all_settings = wpca_get_settings();

// 获取清理设置
$cleanup_settings = wpca_get_settings( 'cleanup', array() );

// 获取菜单顺序设置
$menu_order = wpca_get_settings( 'menu_order', array() );
```

### 2.2 wpca_update_settings

**功能**：更新插件设置
**参数**：
- `$settings` (array)：要更新的设置数组
**返回值**：
- (bool)：更新是否成功，成功返回 true，失败返回 false

**使用示例**：
```php
// 更新设置
$current_settings = wpca_get_settings();
$current_settings['cleanup']['hide_menu'] = array( 'edit-comments.php' );
wpca_update_settings( $current_settings );
```

### 2.3 wpca_get_database_settings

**功能**：获取数据库设置

**参数**：
- `$key` (string)：可选，设置键名，用于获取特定数据库设置
- `$default` (mixed)：可选，默认值，当设置不存在时返回
**返回值**：
- (mixed)：获取到的数据库设置值
**使用示例**：
```php
// 获取所有数据库设置
$db_settings = wpca_get_database_settings();

// 获取自动优化设置
$auto_optimize = wpca_get_database_settings( 'auto_optimize', false );
```

### 2.4 wpca_get_performance_settings

**功能**：获取性能设置

**参数**：
- `$key` (string)：可选，设置键名，用于获取特定性能设置
- `$default` (mixed)：可选，默认值，当设置不存在时返回
**返回值**：
- (mixed)：获取到的性能设置值
**使用示例**：
```php
// 获取所有性能设置
$perf_settings = wpca_get_performance_settings();

// 获取禁用 Emoji 设置
$disable_emoji = wpca_get_performance_settings( 'disable_emoji', false );
```

## 3. 用户权限函数

### 3.1 wpca_current_user_can

**功能**：检查当前用户是否有权限访问 WP Clean Admin 功能
**参数**：无
**返回值**：
- (bool)：是否有权限，有权限返回 true，否则返回 false

**使用示例**：
```php
// 检查用户是否有权限
if ( wpca_current_user_can() ) {
    // 执行需要权限的操作
    echo '用户有权限访问';
} else {
    echo '用户无权访问此功能';
}
```

## 4. URL 和路径函数

### 4.1 wpca_get_plugin_url

**功能**：获取插件 URL

**参数**：
- `$path` (string)：可选，插件内部路径
**返回值**：
- (string)：完整的插件 URL

**使用示例**：
```php
// 获取插件 URL
$plugin_url = wpca_get_plugin_url();

// 获取插件 CSS 文件 URL
$css_url = wpca_get_plugin_url( '/assets/css/wpca-admin.css' );
```

### 4.2 wpca_get_plugin_dir

**功能**：获取插件目录路径
**参数**：
- `$path` (string)：可选，插件内部路径
**返回值**：
- (string)：完整的插件目录路径

**使用示例**：
```php
// 获取插件目录路径
$plugin_dir = wpca_get_plugin_dir();

// 获取 includes 目录路径
$includes_dir = wpca_get_plugin_dir( '/includes/' );
```

### 4.3 wpca_get_asset_url

**功能**：获取资源 URL

**参数**：
- `$asset_path` (string)：资源路径，相对于 assets 目录
**返回值**：
- (string)：完整的资源 URL

**使用示例**：
```php
// 获取 JS 文件 URL
$js_url = wpca_get_asset_url( 'js/wpca-main.js' );

// 获取 CSS 文件 URL
$css_url = wpca_get_asset_url( 'css/wpca-settings.css' );
```

### 4.4 wpca_get_template_path

**功能**：获取模板文件路径
**参数**：
- `$template_name` (string)：模板文件名

**返回值**：
- (string)：完整的模板文件路径
**使用示例**：
```php
// 获取设置页面模板路径
$template_path = wpca_get_template_path( 'settings-page.php' );
```

### 4.5 wpca_load_template

**功能**：加载模板文件
**参数**：
- `$template_name` (string)：模板文件名
- `$args` (array)：传递给模板的参数
**返回值**：无
**使用示例**：
```php
// 加载设置页面模板
wpca_load_template( 'settings-page.php', array(
    'settings' => $settings,
    'current_tab' => $current_tab
) );
```

## 5. 后台界面函数

### 5.1 wpca_admin_notice

**功能**：显示后台通知
**参数**：
- `$message` (string)：通知消息
- `$type` (string)：通知类型，可选值：success, error, warning, info，默认为 info
**返回值**：无
**使用示例**：
```php
// 显示成功通知
wpca_admin_notice( '设置保存成功', 'success' );

// 显示错误通知
wpca_admin_notice( '设置保存失败', 'error' );

// 显示警告通知
wpca_admin_notice( '请检查您的设置', 'warning' );
```

### 5.2 wpca_get_admin_page_title

**功能**：获取后台页面标题
**参数**：
- `$tab` (string)：当前标签页
**返回值**：
- (string)：页面标题
**使用示例**：
```php
// 获取当前标签页
$current_tab = wpca_get_current_tab();
$page_title = wpca_get_admin_page_title( $current_tab );

echo '<h1>' . $page_title . '</h1>';
```

### 5.3 wpca_is_settings_page

**功能**：检查当前页面是否为 WP Clean Admin 设置页面

**参数**：无
**返回值**：
- (bool)：是否为设置页面，是返回 true，否则返回 false

**使用示例**：
```php
// 检查是否为设置页面
if ( wpca_is_settings_page() ) {
    // 执行设置页面相关操作
    echo '当前是 WP Clean Admin 设置页面';
}
```

### 5.4 wpca_get_settings_url

**功能**：获取设置页面 URL

**参数**：
- `$tab` (string)：可选，标签页名称
**返回值**：
- (string)：完整的设置页面 URL

**使用示例**：
```php
// 获取设置页面 URL
$settings_url = wpca_get_settings_url();

// 获取清理设置页面 URL
$cleanup_url = wpca_get_settings_url( 'cleanup' );

// 输出链接
 echo '<a href="' . $cleanup_url . '">清理设置</a>';
```

### 5.5 wpca_get_menu_slug

**功能**：获取插件菜单 slug

**参数**：无
**返回值**：
- (string)：菜单 slug

**使用示例**：
```php
// 获取菜单 slug
$menu_slug = wpca_get_menu_slug();

// 添加子菜单
add_submenu_page(
    $menu_slug,
    '子菜单标题',
    '子菜单',
    'manage_options',
    'wpca-submenu',
    'wpca_submenu_callback'
);
```

### 5.6 wpca_get_current_tab

**功能**：获取当前标签页
**参数**：
- `$default` (string)：可选，默认标签页，默认为 'dashboard'
**返回值**：
- (string)：当前标签页

**使用示例**：
```php
// 获取当前标签页，默认为 'dashboard'
$current_tab = wpca_get_current_tab();

// 获取当前标签页，默认标签页为 'settings'
$current_tab = wpca_get_current_tab( 'settings' );

// 根据标签页执行不同操作
switch ( $current_tab ) {
    case 'dashboard':
        // 执行仪表盘操作
        break;
    case 'settings':
        // 执行设置操作
        break;
    default:
        // 执行默认操作
        break;
}
```

## 6. 插件信息函数
### 6.1 wpca_get_version

**功能**：获取插件版本
**参数**：无
**返回值**：
- (string)：插件版本号
**使用示例**：
```php
// 获取插件版本
$version = wpca_get_version();
echo '插件版本：' . $version;
```

### 6.2 wpca_is_debug

**功能**：检查是否启用调试模式
**参数**：无
**返回值**：
- (bool)：是否启用调试模式，是返回 true，否则返回 false

**使用示例**：
```php
// 检查是否启用调试模式
if ( wpca_is_debug() ) {
    // 执行调试相关操作
    echo '调试模式已启用';
}
```

### 6.3 wpca_log

**功能**：记录日志
**参数**：
- `$message` (mixed)：日志消息，可以是字符串、数组或对象
- `$context` (string)：可选，日志上下文
**返回值**：无
**使用示例**：
```php
// 记录简单消息
wpca_log( '插件初始化完成', 'init' );

// 记录数组
$settings = wpca_get_settings();
wpca_log( $settings, 'settings' );

// 记录对象
$user = wp_get_current_user();
wpca_log( $user, 'user' );
```

## 7. 工具函数

### 7.1 wpca_sanitize_array

**功能**：清理数组数据
**参数**：
- `$data` (array)：要清理的数据数组
**返回值**：
- (array)：清理后的数据数组
**使用示例**：
```php
// 清理用户输入
$user_input = array(
    'name' => '<script>alert("xss")</script>',
    'email' => 'user@example.com',
    'options' => array(
        'enable' => '1',
        'theme' => '<b>dark</b>'
    )
);

$sanitized_input = wpca_sanitize_array( $user_input );
```

### 7.2 wpca_get_text_domain

**功能**：获取插件文本域
**参数**：无
**返回值**：
- (string)：插件文本域
**使用示例**：
```php
// 获取文本域
$text_domain = wpca_get_text_domain();

// 使用文本域翻译
_e( '设置保存成功', $text_domain );
```

### 7.3 wpca_is_wp_version_gte

**功能**：检查 WordPress 版本是否大于等于指定版本
**参数**：
- `$version` (string)：要比较的版本号
**返回值**：
- (bool)：是否大于等于指定版本，是返回 true，否则返回 false

**使用示例**：
```php
// 检查 WordPress 版本
if ( wpca_is_wp_version_gte( '5.0' ) ) {
    // 执行 WordPress 5.0+ 相关操作
    echo '当前 WordPress 版本大于等于 5.0';
} else {
    echo '当前 WordPress 版本小于 5.0，建议升级到 5.0+';
}
```

## 8. 常量
WP Clean Admin 插件定义了以下常量，用于内部使用：
### 8.1 WPCA_VERSION

**功能**：插件版本号
**值**：字符串，当前版本号，例如 '1.7.15'

### 8.2 WPCA_PLUGIN_DIR

**功能**：插件目录路径
**值**：字符串，完整的插件目录路径
### 8.3 WPCA_PLUGIN_URL

**功能**：插件 URL

**值**：字符串，完整的插件 URL

### 8.4 WPCA_TEXT_DOMAIN

**功能**：插件文本域

**值**：字符串，插件文本域，例如 'wp-clean-admin'

## 9. 钩子
WP Clean Admin 插件提供了以下钩子，用于扩展插件功能：
### 9.1 动作钩子

#### wpca_after_save_settings

**功能**：设置保存后触发
**参数**：
- `$settings` (array)：保存的设置数组

**使用示例**：
```php
// 监听设置保存事件
add_action( 'wpca_after_save_settings', 'custom_after_save_settings' );
function custom_after_save_settings( $settings ) {
    // 执行自定义操作
    wpca_log( '设置已保存', 'settings' );
}
```

#### wpca_init

**功能**：插件初始化后触发
**参数**：无
**使用示例**：
```php
// 监听插件初始化事件
add_action( 'wpca_init', 'custom_wpca_init' );
function custom_wpca_init() {
    // 执行自定义初始化操作
    echo '插件已初始化';
}
```

### 9.2 过滤器钩子
#### wpca_hidden_menus

**功能**：过滤要隐藏的菜单
**参数**：
- `$menus` (array)：当前要隐藏的菜单数组
**返回值**：
- (array)：过滤后的菜单数组
**使用示例**：
```php
// 过滤要隐藏的菜单
add_filter( 'wpca_hidden_menus', 'custom_hidden_menus' );
function custom_hidden_menus( $menus ) {
    // 添加要隐藏的菜单
    $menus[] = 'tools.php';
    $menus[] = 'options-general.php';
    return $menus;
}
```

#### wpca_disabled_features

**功能**：过滤要禁用的功能
**参数**：
- `$features` (array)：当前要禁用的功能数组
**返回值**：
- (array)：过滤后的功能数组
**使用示例**：
```php
// 过滤要禁用的功能
add_filter( 'wpca_disabled_features', 'custom_disabled_features' );
function custom_disabled_features( $features ) {
    // 添加要禁用的功能
    $features[] = 'xmlrpc';
    $features[] = 'emoji';
    return $features;
}
```

## 10. 总结

WP Clean Admin 插件提供了丰富的函数和钩子，方便开发者扩展和定制插件功能。这些函数涵盖了设置管理、用户权限、URL 和路径处理、后台界面、插件信息和工具函数等多个方面。

通过使用这些函数，开发者可以轻松地与插件进行交互，扩展插件功能，或者将插件功能集成到自己的项目中。同时，插件还提供了常量和钩子，方便开发者进行更深入的定制和扩展。

建议开发者在使用这些函数时，参考插件的源代码和文档，了解函数的详细用法和参数，以确保正确使用。

## 版本历史

| 版本号 | 更新时间 | 更新内容 | 更新人员 |
|--------|----------|----------|----------|
| 1.0.0 | 2025-11-29 | 初始版本 | Sut |