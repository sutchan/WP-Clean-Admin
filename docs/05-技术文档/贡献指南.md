# WP Clean Admin 贡献指南

欢迎您参与 WP Clean Admin 插件的开发和维护！本指南将帮助您了解如何为项目做出贡献。

## 1. 贡献类型

您可以通过以下方式为 WP Clean Admin 做出贡献：
- **报告 Bug**：发现并报告插件中的问题
- **提出新功能**：提出您认为有用的新功能或改进
- **修复 Bug**：修复已报告的问题
- **编写代码**：实现新功能或改进现有功能
- **改进文档**：完善插件文档和使用指南

## 2. 贡献流程

### 2.1 准备开发环境

1. **注册 GitHub 账号**
2. **Fork 仓库**：访问 [https://github.com/sutchan/WPCleanAdmin](https://github.com/sutchan/WPCleanAdmin) 并点击 "Fork" 按钮
3. **克隆仓库**：将您的 fork 克隆到本地
   ```bash
   git clone https://github.com/your-username/WPCleanAdmin.git
   cd WPCleanAdmin
   ```
4. **添加上游仓库**：将原始仓库添加为上游仓库
   ```bash
   git remote add upstream https://github.com/sutchan/WPCleanAdmin.git
   ```
5. **配置 Git**：设置您的用户名和邮箱

### 2.2 开发流程

1. **创建分支**：从 `develop` 分支创建新分支，用于开发新功能或修复 Bug
   ```bash
   git checkout develop
   git pull upstream develop
   git checkout -b feature/your-feature-name
   # 或用于修复 Bug
   git checkout -b bugfix/your-bugfix-name
   ```
2. **编写代码**：实现您的功能或修复
3. **测试代码**：确保您的代码能够正常工作
4. **提交代码**：提交您的更改
5. **推送分支**：将您的分支推送到 GitHub
   ```bash
   git push origin feature/your-feature-name
   ```
6. **创建 Pull Request**：在 GitHub 上创建 Pull Request，将您的分支合并到 `develop` 分支

### 2.3 Pull Request 要求

1. **清晰的标题**：Pull Request 标题应简洁明了，描述您的更改
2. **详细的描述**：在描述中详细说明您的更改内容和原因
3. **关联 Issue**：如果您的更改与某个 Issue 相关，请在描述中关联该 Issue
4. **通过测试**：确保您的代码通过所有测试
5. **遵循规范**：确保您的代码符合项目的代码规范

## 3. 代码规范

请确保您的代码遵循以下规范：

### 3.1 基础规范

- **编码格式**：所有文件必须使用 UTF-8 编码，无 BOM
- **换行符**：统一使用 Unix LF 换行符
- **缩进**：使用 4 个空格作为缩进，禁止使用制表符
- **行宽**：每行代码长度建议不超过 120 个字符
- **文件名**：使用小写字母和连字符，例如 `class-wpca-core.php`

### 3.2 命名规范

- **类名**：使用 PascalCase，例如 `WPCleanAdmin\Core`
- **方法名**：使用 camelCase，例如 `getInstance()`
- **函数名**：使用 snake_case，例如 `wpca_get_settings()`
- **变量名**：使用 snake_case，例如 `$plugin_settings`
- **常量名**：使用全大写字母和下划线，例如 `WPCA_VERSION`
- **钩子名**：使用 snake_case，例如 `wpca_after_save_settings`

### 3.3 代码风格

- **注释**：为所有公共函数和类添加注释
- **文档块**：使用 PHPDoc 为类和函数添加文档块
- **代码结构**：保持清晰的代码结构，使用适当的空格和换行

### 3.4 安全规范

请遵循 [安全开发实践指南](安全开发实践指南.md) 中的安全规范。

## 4. 提交规范

### 4.1 提交信息格式

提交信息应包含以下部分：

```
类型: 简短描述

详细描述

关联 #issue-number
```

### 4.2 提交类型

- **feat**：新功能
- **fix**：修复 Bug
- **docs**：文档更改
- **style**：代码风格更改（不影响功能）
- **refactor**：代码重构（不添加功能或修复 Bug）
- **test**：测试相关更改
- **chore**：构建或辅助工具更改

### 4.3 提交示例

```
feat: 添加菜单定制功能

- 实现了菜单拖拽排序功能
- 添加了菜单组创建功能
- 支持按角色显示菜单

关联 #123
```

```
fix: 修复数据库优化功能的错误

- 修复了 SQL 查询错误
- 改进了错误处理

关联 #456
```

## 5. 分支管理

### 5.1 主要分支

- **main**：主分支，用于发布稳定版本
  - 仅包含经过测试的稳定代码
  - 每次发布新版本时从 develop 分支合并
  - 不直接接受 Pull Request

- **develop**：开发分支，用于集成新功能
  - 包含最新的开发代码
  - 接受新功能和 Bug 修复的 Pull Request
  - 定期合并到 main 分支用于发布新版本

### 5.2 功能分支

- **feature/xxx**：用于开发新功能
  - 从 develop 分支创建
  - 完成后合并回 develop 分支
  - 命名格式：`feature/feature-name`

- **bugfix/xxx**：用于修复 Bug
  - 从 develop 分支创建
  - 完成后合并回 develop 分支
  - 命名格式：`bugfix/bugfix-name`

- **hotfix/xxx**：用于修复生产环境中的紧急 Bug
  - 从 main 分支创建
  - 完成后合并回 main 和 develop 分支
  - 命名格式：`hotfix/hotfix-name`

- **release/xxx**：用于准备新版本发布
  - 从 develop 分支创建
  - 用于更新版本号和 CHANGELOG
  - 完成后合并回 main 和 develop 分支
  - 命名格式：`release/version-number`

## 6. 测试规范

### 6.1 测试类型

- **单元测试**：测试单个函数或方法
- **集成测试**：测试多个模块之间的交互
- **功能测试**：测试完整的功能流程
- **兼容性测试**：测试插件与不同环境的兼容性

### 6.2 测试工具

- **PHPUnit**：用于 PHP 单元测试
- **QUnit**：用于 JavaScript 单元测试
- **WP CLI**：用于 WordPress 集成测试

### 6.3 测试覆盖率

- **代码覆盖率**：争取达到 80% 以上的代码覆盖率
- **测试用例**：为每个功能编写测试用例
- **持续集成**：使用 CI 工具自动运行测试

### 6.4 运行测试

```bash
# 运行 PHPUnit 测试
vendor/bin/phpunit

# 运行 QUnit 测试
npm test

# 运行 WordPress 集成测试
wp test
```

## 7. 文档规范

### 7.1 文档类型

- **代码注释**：为所有公共函数和类添加注释
- **API 文档**：详细说明插件的 API
- **使用指南**：说明如何使用插件
- **CHANGELOG**：记录版本更新内容

### 7.2 文档格式

- **格式**：使用 Markdown 格式
- **编码**：UTF-8 编码，无 BOM
- **换行符**：Unix LF 换行符
- **结构**：保持清晰的文档结构

### 7.3 文档目录

```
docs/
├── 01-文档指南/               # 文档指南
├── 02-项目概述/               # 项目概述
├── 03-使用指南/               # 使用指南
├── 04-功能模块/               # 功能模块
├── 05-技术文档/               # 技术文档
├── 06-开发指南/               # 开发指南
├── 07-测试文档/               # 测试文档
├── 08-部署文档/               # 部署文档
├── 09-运维文档/               # 运维文档
├── 10-工具文档/               # 工具文档
└── 11-附录/                   # 附录
```

## 8. 国际化

### 8.1 翻译流程

1. **更新 POT 文件**：在 `languages/` 目录中更新 `wp-clean-admin.pot` 文件
2. **创建翻译文件**：使用 Poedit 或其他工具创建 `.po` 翻译文件
3. **翻译内容**：翻译所有可翻译字符串
4. **生成 MO 文件**：生成 `.mo` 二进制文件
5. **提交翻译**：将翻译文件提交到 GitHub

### 8.2 翻译规范

- **文本域**：使用 `WPCA_TEXT_DOMAIN` 常量
- **翻译函数**：使用 `__()`, `_e()`, `_x()`, `_ex()` 等翻译函数
- **避免硬编码**：避免在代码中硬编码文本
- **上下文**：为翻译添加适当的上下文
- **测试翻译**：确保翻译在 WordPress 中正常显示

## 9. Bug 报告

### 9.1 报告流程

1. **搜索 Issues**：首先搜索现有的 Issues，确认问题是否已经被报告
2. **创建 Issue**：如果问题未被报告，创建一个新的 Issue
3. **描述问题**：详细描述问题，包括：
   - 问题的具体表现
   - WordPress 版本和 PHP 版本
   - 复现步骤
   - 预期行为
   - 实际行为
   - 相关截图（如果适用）

### 9.2 Bug 标签

- **bug**：确认的 Bug
- **enhancement**：功能增强
- **documentation**：文档相关
- **question**：问题或疑问
- **help wanted**：需要帮助
- **good first issue**：适合新贡献者的问题

## 10. 功能请求

### 10.1 请求流程

1. **搜索 Issues**：首先搜索现有的 Issues，确认功能是否已经被请求
2. **创建 Issue**：如果功能未被请求，创建一个新的 Issue
3. **描述功能**：详细描述您希望添加的功能，包括：
   - 功能的用途和价值
   - 功能的具体实现思路
   - 预期的用户体验
   - 相关示例或参考（如果有）
   - 实现该功能的优先级

### 10.2 功能标签

功能请求使用以下标签：
- **feature**：新功能请求
- **enhancement**：现有功能的增强
- **priority**：功能的优先级
- **help wanted**：需要帮助实现
- **discussion**：需要讨论的功能

## 11. 开发环境设置

### 11.1 系统要求

- **操作系统**：Windows, macOS, Linux
- **PHP**：7.0+（推荐 7.4+）
- **WordPress**：5.0+（推荐 6.0+）
- **MySQL**：5.6+（推荐 5.7+）
- **Git**：版本控制工具

### 11.2 本地开发环境

您可以使用以下工具搭建本地开发环境：

- **XAMPP**：适用于 Windows, macOS, Linux
- **MAMP**：适用于 macOS, Windows
- **WAMP**：适用于 Windows
- **Docker**：容器化开发环境
- **VVV (Varying Vagrant Vagrants)**：专为 WordPress 开发设计

### 11.3 设置步骤

1. **安装本地环境**：安装并配置 XAMPP, MAMP, WAMP 或其他本地环境
2. **安装 WordPress**：在本地环境中安装 WordPress
3. **克隆仓库**：将插件仓库克隆到 WordPress 插件目录
   ```bash
   cd /path/to/wordpress/wp-content/plugins/
   git clone https://github.com/your-username/WPCleanAdmin.git wpcleanadmin
   ```
4. **激活插件**：在 WordPress 后台激活插件
5. **开始开发**：开始开发和测试插件

## 12. 代码审查

### 12.1 审查流程

代码审查是确保代码质量的重要环节，所有代码变更都需要经过审查：

- **自我审查**：在提交 Pull Request 前，先自行审查代码
- **团队审查**：由项目维护者或其他贡献者审查代码
- **反馈**：审查者提供反馈和建议
- **修改**：根据反馈修改代码
- **合并**：审查通过后，合并代码

### 12.2 审查要点

审查时主要关注以下方面：

1. **功能完整性**：代码是否实现了预期功能
2. **代码质量**：代码是否清晰、可维护
3. **安全性**：代码是否存在安全问题
4. **性能**：代码是否影响性能
5. **兼容性**：代码是否兼容不同环境
6. **测试**：代码是否有适当的测试
7. **文档**：代码是否有适当的文档

## 13. 版本发布

### 13.1 版本号格式

项目使用语义化版本号（SemVer），格式为 MAJOR.MINOR.PATCH

- **MAJOR**：不兼容的 API 变更
- **MINOR**：向后兼容的新功能
- **PATCH**：向后兼容的 Bug 修复

### 13.2 发布流程

1. **创建发布分支**：从 develop 分支创建 release 分支
   ```bash
   git checkout develop
   git pull upstream develop
   git checkout -b release/1.7.16
   ```

2. **更新版本号**：更新插件中的版本号
   - `wpcleanadmin/wp-clean-admin.php`：插件主文件中的版本号
   - `wpcleanadmin/includes/wpca-core-functions.php`：核心函数中的版本号

3. **更新 CHANGELOG**：更新 CHANGELOG.md 文件，添加新版本的更新内容

4. **运行测试**：确保所有测试通过

5. **提交更改**：提交版本号和 CHANGELOG 的更改
   ```bash
   git add .
   git commit -m "chore: 准备发布版本 1.7.16"
   ```

6. **合并到 main**：将 release 分支合并到 main 分支
   ```bash
   git checkout main
   git merge release/1.7.16
   git push upstream main
   ```

7. **创建标签**：为新版本创建 Git 标签
   ```bash
   git tag v1.7.16
   git push upstream v1.7.16
   ```

8. **合并到 develop**：将 release 分支合并到 develop 分支
   ```bash
   git checkout develop
   git merge release/1.7.16
   git push upstream develop
   ```

9. **删除发布分支**：删除临时的 release 分支
   ```bash
   git branch -d release/1.7.16
   ```

10. **发布到 WordPress.org**：将新版本发布到 WordPress.org 插件目录

## 14. 常见问题

### 14.1 如何获取帮助

如果您在开发过程中遇到问题，可以通过以下方式获取帮助：

- **GitHub Issues**：提交问题或疑问
- **GitHub Discussions**：参与讨论
- **WordPress Slack**：加入 WordPress 社区 Slack 频道
- **文档**：查阅项目文档
- **代码示例**：参考现有代码示例

## 15. 许可证

WP Clean Admin 使用 GPL-2.0+ 许可证，详情请查看 [LICENSE](https://github.com/sutchan/WPCleanAdmin/blob/main/LICENSE) 文件。

## 16. 致谢

感谢所有为 WP Clean Admin 插件做出贡献的开发者和用户！您的贡献对项目的成功至关重要。

通过遵循本指南，您可以确保您的贡献符合项目的要求，从而更快地被合并和发布。如果您有任何疑问或建议，请随时通过 GitHub Issues 或 Discussions 提出。

祝您开发愉快！