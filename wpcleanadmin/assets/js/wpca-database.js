/**\r\n * WP Clean Admin Database JavaScript\r\n *\r\n * @package WPCA\r\n * @version 1.8.0\r\n * @author Sut\r\n * @author URI: https://github.com/sutchan\r\n * @since 1.7.15\r\n */\r\n// Use IIFE to encapsulate the database functionality\r\n(function($) {\r\n    'use strict';\r\n    \r\n    /**\r\n     * Database functionality for WPCA\r\n     */\r\n    const WPCADatabase = {\r\n        /**\r\n         * Initialize database functionality\r\n         */\r\n        init: function() {\r\n            this.bindEvents();\r\n            this.initDatabaseTables();\r\n        },\r\n        \r\n        /**\r\n         * Bind events for database\r\n         */\r\n        bindEvents: function() {\r\n            // Handle database optimization buttons\r\n            $(document).on('click', '.wpca-db-optimize-btn', this.handleDatabaseOptimize.bind(this));\r\n            \r\n            // Handle database cleanup buttons\r\n            $(document).on('click', '.wpca-db-cleanup-btn', this.handleDatabaseCleanup.bind(this));\r\n            \r\n            // Handle database backup buttons\r\n            $(document).on('click', '.wpca-db-backup-btn', this.handleDatabaseBackup.bind(this));\r\n        },\r\n        \r\n        /**\r\n         * Initialize database tables display\r\n         */\r\n        initDatabaseTables: function() {\r\n            // Add visual indicators for database table states\r\n            $('.wpca-db-table').each(function() {\r\n                const $table = $(this);\r\n                WPCADatabase.updateTableVisuals($table);\r\n            });\r\n        },\r\n        \r\n        /**\r\n         * Handle database optimization buttons\r\n         * @param {Event} e - The click event\r\n         */\r\n        handleDatabaseOptimize: function(e) {\r\n            e.preventDefault();\r\n            \r\n            const $btn = $(e.currentTarget);\r\n            const tableName = $btn.data('table') || 'selected tables';\r\n            const confirmText = $btn.data('confirm') || `Are you sure you want to optimize ${tableName}? This may take a few moments.`;\r\n            \r\n            if (confirm(confirmText)) {\r\n                this.performDatabaseAction($btn, 'optimize');\r\n            }\r\n        },\r\n        \r\n        /**\r\n         * Handle database cleanup buttons\r\n         * @param {Event} e - The click event\r\n         */\r\n        handleDatabaseCleanup: function(e) {\r\n            e.preventDefault();\r\n            \r\n            const $btn = $(e.currentTarget);\r\n            const cleanupType = $btn.data('cleanup-type') || 'general';\r\n            const confirmText = $btn.data('confirm') || `Are you sure you want to perform ${cleanupType} cleanup? This action cannot be undone.`;\r\n            \r\n            if (confirm(confirmText)) {\r\n                this.performDatabaseAction($btn, 'cleanup');\r\n            }\r\n        },\r\n        \r\n        /**\r\n         * Handle database backup buttons\r\n         * @param {Event} e - The click event\r\n         */\r\n        handleDatabaseBackup: function(e) {\r\n            e.preventDefault();\r\n            \r\n            const $btn = $(e.currentTarget);\r\n            const backupType = $btn.data('backup-type') || 'full';\r\n            const confirmText = $btn.data('confirm') || `Are you sure you want to create a ${backupType} database backup? This may take a few moments.`;\r\n            \r\n            if (confirm(confirmText)) {\r\n                this.performDatabaseAction($btn, 'backup');\r\n            }\r\n        },\r\n        \r\n        /**\r\n         * Perform database actions\r\n         * @param {jQuery} $btn - The action button\r\n         * @param {string} action - The action type\r\n         */\r\n        performDatabaseAction: function($btn, action) {\r\n            const originalText = $btn.text();\r\n            const processingText = $btn.data('processing-text') || `${action.charAt(0).toUpperCase() + action.slice(1)}ing...`;\r\n            \r\n            // Add loading state\r\n            $btn.prop('disabled', true).text(processingText);\r\n            \r\n            // Trigger custom event for database action\r\n            $(document).trigger('wpca_database_action_started', { \r\n                action: action, \r\n                button: $btn \r\n            });\r\n        },\r\n        \r\n        /**\r\n         * Update visual feedback for database tables\r\n         * @param {jQuery} $table - The table element\r\n         */\r\n        updateTableVisuals: function($table) {\r\n            // Update table visual indicators based on size and status\r\n            const size = parseInt($table.data('size') || 0, 10);\r\n            const status = $table.data('status') || 'normal';\r\n            \r\n            $table.removeClass('wpca-db-table-small wpca-db-table-medium wpca-db-table-large wpca-db-table-status-normal wpca-db-table-status-warning wpca-db-table-status-error');\r\n            \r\n            // Add size class\r\n            if (size < 1024) {\r\n                $table.addClass('wpca-db-table-small');\r\n            } else if (size < 10240) {\r\n                $table.addClass('wpca-db-table-medium');\r\n            } else {\r\n                $table.addClass('wpca-db-table-large');\r\n            }\r\n            \r\n            // Add status class\r\n            $table.addClass(`wpca-db-table-status-${status}`);\r\n        }\r\n    };\r\n    \r\n    // Initialize database functionality when DOM is ready\r\n    $(document).ready(function() {\r\n        WPCADatabase.init();\r\n    });\r\n    \r\n    // Expose to global scope for potential external use\r\n    window.WPCADatabase = WPCADatabase;\r\n})(jQuery);\r\n
