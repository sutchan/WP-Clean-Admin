<?php\r\n/**\r\n * WPCleanAdmin Menu Manager Class\r\n *\r\n * @package WPCleanAdmin\r\n * @version 1.7.15\r\n * @author Sut\r\n * @author URI: https://github.com/sutchan\r\n * @since 1.7.15\r\n */\r\nnamespace WPCleanAdmin;\r\n\r\nif ( ! defined( 'ABSPATH' ) ) {\r\n    exit;\r\n}\r\n\r\n/**\r\n * Menu_Manager class\r\n */\r\nclass Menu_Manager {\r\n    \r\n    /**\r\n     * Singleton instance\r\n     *\r\n     * @var Menu_Manager\r\n     */\r\n    private static $instance;\r\n    \r\n    /**\r\n     * Get singleton instance\r\n     *\r\n     * @return Menu_Manager\r\n     */\r\n    public static function getInstance() {\r\n        if ( ! isset( self::$instance ) ) {\r\n            self::$instance = new self();\r\n        }\r\n        return self::$instance;\r\n    }\r\n    \r\n    /**\r\n     * Constructor\r\n     */\r\n    private function __construct() {\r\n        $this->init();\r\n    }\r\n    \r\n    /**\r\n     * Initialize the menu manager module\r\n     */\r\n    public function init() {\r\n        // Load settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        // Apply menu optimizations based on settings\r\n        if ( isset( $settings['menu'] ) && function_exists( 'add_action' ) ) {\r\n            // Remove dashboard widgets\r\n            if ( isset( $settings['menu']['remove_dashboard_widgets'] ) && $settings['menu']['remove_dashboard_widgets'] ) {\r\n                \add_action( 'wp_dashboard_setup', array( $this, 'remove_dashboard_widgets' ) );\r\n            }\r\n            \r\n            // Simplify admin menu\r\n            if ( isset( $settings['menu']['simplify_admin_menu'] ) && $settings['menu']['simplify_admin_menu'] ) {\r\n                \add_action( 'admin_menu', array( $this, 'simplify_admin_menu' ), 999 );\r\n            }\r\n            \r\n            // Clean admin bar\r\n            if ( isset( $settings['general']['clean_admin_bar'] ) && $settings['general']['clean_admin_bar'] ) {\r\n                \add_action( 'admin_bar_menu', array( $this, 'clean_admin_bar' ), 999 );\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Remove dashboard widgets\r\n     */\r\n    public function remove_dashboard_widgets() {\r\n        // Remove default WordPress dashboard widgets\r\n        if ( function_exists( '\remove_meta_box' ) ) {\r\n            \remove_meta_box( 'dashboard_right_now', 'dashboard', 'normal' );\r\n            \remove_meta_box( 'dashboard_activity', 'dashboard', 'normal' );\r\n            \remove_meta_box( 'dashboard_recent_comments', 'dashboard', 'normal' );\r\n            \remove_meta_box( 'dashboard_incoming_links', 'dashboard', 'normal' );\r\n            \remove_meta_box( 'dashboard_plugins', 'dashboard', 'normal' );\r\n            \remove_meta_box( 'dashboard_recent_drafts', 'dashboard', 'side' );\r\n            \remove_meta_box( 'dashboard_primary', 'dashboard', 'side' );\r\n            \remove_meta_box( 'dashboard_secondary', 'dashboard', 'side' );\r\n        }\r\n        \r\n        // Remove WordPress welcome panel\r\n        if ( function_exists( '\remove_action' ) ) {\r\n            \remove_action( 'welcome_panel', 'wp_welcome_panel' );\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Simplify admin menu\r\n     */\r\n    public function simplify_admin_menu() {\r\n        global $menu, $submenu;\r\n        \r\n        // Menu items to remove\r\n        $menu_items_to_remove = array(\r\n            'edit-comments.php', // Comments\r\n            'edit.php?post_type=page', // Pages\r\n            'upload.php', // Media\r\n            'themes.php', // Appearance\r\n            'plugins.php', // Plugins\r\n            'users.php', // Users\r\n            'tools.php', // Tools\r\n            'options-general.php', // Settings\r\n        );\r\n        \r\n        // Remove menu items\r\n        foreach ( $menu as $key => $menu_item ) {\r\n            if ( isset( $menu_item[2] ) && in_array( $menu_item[2], $menu_items_to_remove ) ) {\r\n                unset( $menu[$key] );\r\n            }\r\n        }\r\n        \r\n        // Remove submenu items\r\n        if ( isset( $submenu['edit.php'] ) ) {\r\n            // Remove Posts submenu items\r\n            $post_submenu_to_remove = array(\r\n                'edit.php?post_type=post', // All Posts\r\n                'post-new.php', // Add New\r\n                'edit-tags.php?taxonomy=category', // Categories\r\n                'edit-tags.php?taxonomy=post_tag', // Tags\r\n            );\r\n            \r\n            foreach ( $submenu['edit.php'] as $key => $submenu_item ) {\r\n                if ( isset( $submenu_item[2] ) && in_array( $submenu_item[2], $post_submenu_to_remove ) ) {\r\n                    unset( $submenu['edit.php'][$key] );\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clean admin bar\r\n     *\r\n     * @param WP_Admin_Bar $wp_admin_bar Admin bar object\r\n     */\r\n    public function clean_admin_bar( $wp_admin_bar ) {\r\n        // Remove default WordPress admin bar items\r\n        $wp_admin_bar->remove_node( 'wp-logo' );\r\n        $wp_admin_bar->remove_node( 'about' );\r\n        $wp_admin_bar->remove_node( 'wporg' );\r\n        $wp_admin_bar->remove_node( 'documentation' );\r\n        $wp_admin_bar->remove_node( 'support-forums' );\r\n        $wp_admin_bar->remove_node( 'feedback' );\r\n        $wp_admin_bar->remove_node( 'site-name' );\r\n        $wp_admin_bar->remove_node( 'view-site' );\r\n        $wp_admin_bar->remove_node( 'comments' );\r\n        $wp_admin_bar->remove_node( 'new-content' );\r\n        $wp_admin_bar->remove_node( 'w3tc' ); // W3 Total Cache\r\n        $wp_admin_bar->remove_node( 'wpseo-menu' ); // Yoast SEO\r\n    }\r\n    \r\n    /**\r\n     * Get menu items\r\n     *\r\n     * @return array Menu items\r\n     */\r\n    public function get_menu_items() {\r\n        global $menu, $submenu;\r\n        \r\n        $menu_items = array();\r\n        \r\n        // Get top-level menu items\r\n        foreach ( $menu as $key => $menu_item ) {\r\n            if ( ! empty( $menu_item[0] ) && $menu_item[0] !== '-' ) {\r\n                $menu_item_data = array(\r\n                    'id' => $key,\r\n                    'title' => $menu_item[0],\r\n                    'slug' => $menu_item[2],\r\n                    'capability' => $menu_item[1],\r\n                    'icon' => $menu_item[6],\r\n                    'position' => $menu_item[5],\r\n                    'submenu' => array()\r\n                );\r\n                \r\n                // Get submenu items\r\n                if ( isset( $submenu[$menu_item[2]] ) ) {\r\n                    foreach ( $submenu[$menu_item[2]] as $submenu_key => $submenu_item ) {\r\n                        $menu_item_data['submenu'][] = array(\r\n                            'id' => $submenu_key,\r\n                            'title' => $submenu_item[0],\r\n                            'slug' => $submenu_item[2],\r\n                            'capability' => $submenu_item[1]\r\n                        );\r\n                    }\r\n                }\r\n                \r\n                $menu_items[] = $menu_item_data;\r\n            }\r\n        }\r\n        \r\n        return $menu_items;\r\n    }\r\n    \r\n    /**\r\n     * Save menu items\r\n     *\r\n     * @param array $menu_items Menu items to save\r\n     * @return array Save results\r\n     */\r\n    public function save_menu_items( $menu_items ) {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Menu items saved successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Save menu items to options\r\n        if ( function_exists( 'update_option' ) ) {\r\n            \update_option( 'wpca_menu_items', $menu_items );\r\n        }\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Remove dashboard widgets based on settings\r\n     */\r\n    public function remove_dashboard_widgets_by_settings() {\r\n        // Load settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        if ( isset( $settings['menu']['dashboard_widgets'] ) && function_exists( '\remove_meta_box' ) ) {\r\n            $widgets_to_remove = $settings['menu']['dashboard_widgets'];\r\n            \r\n            foreach ( $widgets_to_remove as $widget_id => $remove ) {\r\n                if ( $remove ) {\r\n                    \remove_meta_box( $widget_id, 'dashboard', 'normal' );\r\n                    \remove_meta_box( $widget_id, 'dashboard', 'side' );\r\n                    \remove_meta_box( $widget_id, 'dashboard', 'column3' );\r\n                    \remove_meta_box( $widget_id, 'dashboard', 'column4' );\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Simplify admin menu based on settings\r\n     */\r\n    public function simplify_admin_menu_by_settings() {\r\n        // Load settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        if ( isset( $settings['menu']['menu_items'] ) && function_exists( 'add_action' ) ) {\r\n            $menu_items_to_remove = $settings['menu']['menu_items'];\r\n            \r\n            // Add action to remove menu items\r\n            \add_action( 'admin_menu', function() use ( $menu_items_to_remove ) {\r\n                global $menu, $submenu;\r\n                \r\n                // Remove top-level menu items\r\n                foreach ( $menu as $key => $menu_item ) {\r\n                    if ( isset( $menu_item[2] ) && isset( $menu_items_to_remove[$menu_item[2]] ) && $menu_items_to_remove[$menu_item[2]] ) {\r\n                        unset( $menu[$key] );\r\n                    }\r\n                }\r\n                \r\n                // Remove submenu items\r\n                foreach ( $submenu as $parent_slug => $submenu_items ) {\r\n                    foreach ( $submenu_items as $key => $submenu_item ) {\r\n                        if ( isset( $submenu_item[2] ) && isset( $menu_items_to_remove[$submenu_item[2]] ) && $menu_items_to_remove[$submenu_item[2]] ) {\r\n                            unset( $submenu[$parent_slug][$key] );\r\n                        }\r\n                    }\r\n                }\r\n            }, 999 );\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Clean up admin menu\r\n     */\r\n    public function cleanup_admin_menu() {\r\n        // Load settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        if ( isset( $settings['menu'] ) ) {\r\n            // Remove dashboard widgets\r\n            if ( isset( $settings['menu']['remove_dashboard_widgets'] ) && $settings['menu']['remove_dashboard_widgets'] ) {\r\n                $this->remove_dashboard_widgets();\r\n            }\r\n            \r\n            // Simplify admin menu\r\n            if ( isset( $settings['menu']['simplify_admin_menu'] ) && $settings['menu']['simplify_admin_menu'] ) {\r\n                $this->simplify_admin_menu();\r\n            }\r\n            \r\n            // Clean admin bar\r\n            if ( isset( $settings['general']['clean_admin_bar'] ) && $settings['general']['clean_admin_bar'] && function_exists( 'add_action' ) ) {\r\n                \add_action( 'admin_bar_menu', array( $this, 'clean_admin_bar' ), 999 );\r\n            }\r\n        }\r\n    }\r\n}