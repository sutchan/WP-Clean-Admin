<?php\r\n/**\r\n * WPCleanAdmin Ajax Class\r\n *\r\n * @package WPCleanAdmin\r\n * @version 1.7.15\r\n * @author Sut\r\n * @author URI: https://github.com/sutchan\r\n * @since 1.7.15\r\n */\r\nnamespace WPCleanAdmin;\r\n\r\n/**\r\n * WPCleanAdmin AJAX Handler\r\n *\r\n * This class handles all AJAX requests for the WPCleanAdmin plugin.\r\n *\r\n * @package WPCleanAdmin\r\n * @subpackage AJAX\r\n * @since 1.7.15\r\n */\r\n\r\nif ( ! defined( 'ABSPATH' ) ) {\r\n    exit;\r\n}\r\n\r\nclass AJAX {\r\n\r\n    /**\r\n     * Instance of this class.\r\n     *\r\n     * @since 1.7.15\r\n     * @var AJAX\r\n     */\r\n    protected static $instance = null;\r\n\r\n    /**\r\n     * Initialize the class and set its properties.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    private function __construct() {\r\n        $this->register_ajax_hooks();\r\n    }\r\n\r\n    /**\r\n     * Return an instance of this class.\r\n     *\r\n     * @since 1.7.15\r\n     * @return AJAX A single instance of this class.\r\n     */\r\n    public static function getInstance() {\r\n        if ( null === self::$instance ) {\r\n            self::$instance = new self();\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    /**\r\n     * Register all AJAX hooks.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    private function register_ajax_hooks() {\r\n        // Dashboard AJAX actions\r\n        \add_action( 'wp_ajax_wpca_get_dashboard_stats', array( $this, 'get_dashboard_stats' ) );\r\n        \add_action( 'wp_ajax_wpca_get_system_info', array( $this, 'get_system_info' ) );\r\n        \add_action( 'wp_ajax_wpca_run_quick_action', array( $this, 'run_quick_action' ) );\r\n        \r\n        // Cleanup AJAX actions\r\n        \add_action( 'wp_ajax_wpca_cleanup_database', array( $this, 'cleanup_database' ) );\r\n        \add_action( 'wp_ajax_wpca_cleanup_media', array( $this, 'cleanup_media' ) );\r\n        \add_action( 'wp_ajax_wpca_cleanup_comments', array( $this, 'cleanup_comments' ) );\r\n        \add_action( 'wp_ajax_wpca_cleanup_content', array( $this, 'cleanup_content' ) );\r\n        \add_action( 'wp_ajax_wpca_get_cleanup_stats', array( $this, 'get_cleanup_stats' ) );\r\n        \r\n        // Settings AJAX actions\r\n        \add_action( 'wp_ajax_wpca_save_settings', array( $this, 'save_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_get_settings', array( $this, 'get_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_reset_settings', array( $this, 'reset_settings' ) );\r\n        \r\n        // User Roles AJAX actions\r\n        \add_action( 'wp_ajax_wpca_get_user_roles', array( $this, 'get_user_roles' ) );\r\n        \add_action( 'wp_ajax_wpca_update_role_capabilities', array( $this, 'update_role_capabilities' ) );\r\n        \add_action( 'wp_ajax_wpca_create_role', array( $this, 'create_role' ) );\r\n        \add_action( 'wp_ajax_wpca_delete_role', array( $this, 'delete_role' ) );\r\n        \add_action( 'wp_ajax_wpca_duplicate_role', array( $this, 'duplicate_role' ) );\r\n        \r\n        // Menu Manager AJAX actions\r\n        \add_action( 'wp_ajax_wpca_get_menu_items', array( $this, 'get_menu_items' ) );\r\n        \add_action( 'wp_ajax_wpca_save_menu_items', array( $this, 'save_menu_items' ) );\r\n        \r\n        // Performance AJAX actions\r\n        \add_action( 'wp_ajax_wpca_optimize_database', array( $this, 'optimize_database' ) );\r\n        \add_action( 'wp_ajax_wpca_clear_cache', array( $this, 'clear_cache' ) );\r\n        \add_action( 'wp_ajax_wpca_get_performance_stats', array( $this, 'get_performance_stats' ) );\r\n        \r\n        // Reset AJAX actions\r\n        \add_action( 'wp_ajax_wpca_reset_settings', array( $this, 'reset_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_reset_plugin', array( $this, 'reset_plugin' ) );\r\n        \r\n        // Database AJAX actions\r\n        \add_action( 'wp_ajax_wpca_get_database_info', array( $this, 'get_database_info' ) );\r\n        \add_action( 'wp_ajax_wpca_backup_database', array( $this, 'backup_database' ) );\r\n        \add_action( 'wp_ajax_wpca_restore_database', array( $this, 'restore_database' ) );\r\n        \add_action( 'wp_ajax_wpca_get_database_backups', array( $this, 'get_database_backups' ) );\r\n        \add_action( 'wp_ajax_wpca_delete_database_backup', array( $this, 'delete_database_backup' ) );\r\n        \r\n        // Resources AJAX actions\r\n        \add_action( 'wp_ajax_wpca_get_resources_stats', array( $this, 'get_resources_stats' ) );\r\n        \add_action( 'wp_ajax_wpca_get_resource_details', array( $this, 'get_resource_details' ) );\r\n        \add_action( 'wp_ajax_wpca_optimize_resources', array( $this, 'optimize_resources' ) );\r\n        \add_action( 'wp_ajax_wpca_disable_resource', array( $this, 'disable_resource' ) );\r\n        \add_action( 'wp_ajax_wpca_enable_resource', array( $this, 'enable_resource' ) );\r\n        \r\n        // Menu Customizer AJAX actions\r\n        \add_action( 'wp_ajax_wpca_save_menu_customizer_settings', array( $this, 'save_menu_customizer_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_get_menu_customizer_settings', array( $this, 'get_menu_customizer_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_reset_menu_customizer_settings', array( $this, 'reset_menu_customizer_settings' ) );\r\n        \r\n        // Database Settings AJAX actions\r\n        \add_action( 'wp_ajax_wpca_save_database_settings', array( $this, 'save_database_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_get_database_settings', array( $this, 'get_database_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_reset_database_settings', array( $this, 'reset_database_settings' ) );\r\n        \r\n        // Performance Settings AJAX actions\r\n        \add_action( 'wp_ajax_wpca_save_performance_settings', array( $this, 'save_performance_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_get_performance_settings', array( $this, 'get_performance_settings' ) );\r\n        \add_action( 'wp_ajax_wpca_reset_performance_settings', array( $this, 'reset_performance_settings' ) );\r\n    }\r\n\r\n    /**\r\n     * Verify AJAX nonce and check user capabilities.\r\n     *\r\n     * @since 1.7.15\r\n     * @param string $action The AJAX action name.\r\n     * @return bool True if the nonce is valid and user has capabilities, false otherwise.\r\n     */\r\n    private function verify_ajax_request( $action ) {\r\n        if ( ! function_exists( '\wp_verify_nonce' ) || ! \wp_verify_nonce( $_POST['_wpnonce'], 'wpca_ajax_nonce' ) ) {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( \__( 'Invalid nonce', WPCA_TEXT_DOMAIN ) );\r\n            }\r\n            return false;\r\n        }\r\n        \r\n        if ( ! function_exists( '\current_user_can' ) || ! \current_user_can( 'manage_options' ) ) {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( \__( 'Insufficient permissions', WPCA_TEXT_DOMAIN ) );\r\n            }\r\n            return false;\r\n        }\r\n        \r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Get dashboard statistics.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_dashboard_stats() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_dashboard_stats' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $dashboard = new Dashboard();\r\n        $stats = $dashboard->get_dashboard_stats();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $stats );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get system information.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_system_info() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_system_info' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $dashboard = new Dashboard();\r\n        $system_info = $dashboard->get_system_info();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $system_info );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Run quick action.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function run_quick_action() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_run_quick_action' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $action = isset( $_POST['action_name'] ) ? sanitize_text_field( $_POST['action_name'] ) : '';\r\n        \r\n        $dashboard = new Dashboard();\r\n        $result = $dashboard->run_quick_action( $action );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cleanup database.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function cleanup_database() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_cleanup_database' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $options = isset( $_POST['options'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['options'] ) : $_POST['options'] ) : array();\r\n        \r\n        $cleanup = new Cleanup();\r\n        $result = $cleanup->run_database_cleanup( $options );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cleanup media.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function cleanup_media() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_cleanup_media' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $options = isset( $_POST['options'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['options'] ) : $_POST['options'] ) : array();\r\n        \r\n        $cleanup = new Cleanup();\r\n        $result = $cleanup->run_media_cleanup( $options );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cleanup comments.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function cleanup_comments() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_cleanup_comments' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $options = isset( $_POST['options'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['options'] ) : $_POST['options'] ) : array();\r\n        \r\n        $cleanup = new Cleanup();\r\n        $result = $cleanup->run_comments_cleanup( $options );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Cleanup content.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function cleanup_content() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_cleanup_content' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $options = isset( $_POST['options'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['options'] ) : $_POST['options'] ) : array();\r\n        \r\n        $cleanup = new Cleanup();\r\n        $result = $cleanup->run_content_cleanup( $options );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get cleanup statistics.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_cleanup_stats() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_cleanup_stats' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $cleanup = new Cleanup();\r\n        $stats = $cleanup->get_cleanup_stats();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $stats );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function save_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_save_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $settings = isset( $_POST['settings'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['settings'] ) : $_POST['settings'] ) : array();\r\n        \r\n        $settings_manager = new Settings();\r\n        $result = wpca_update_settings( $settings );\r\n        \r\n        if ( $result ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( array( 'message' => \__( 'Settings saved successfully', WPCA_TEXT_DOMAIN ) ) );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( \__( 'Failed to save settings', WPCA_TEXT_DOMAIN ) );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $settings = wpca_get_settings();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $settings );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function reset_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_reset_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $reset = new Reset();\r\n        $result = $reset->reset_settings();\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get user roles.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_user_roles() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_user_roles' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $user_roles = new User_Roles();\r\n        $roles = $user_roles->get_user_roles();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $roles );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update role capabilities.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function update_role_capabilities() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_update_role_capabilities' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $role_slug = isset( $_POST['role_slug'] ) ? sanitize_text_field( $_POST['role_slug'] ) : '';\r\n        $capabilities = isset( $_POST['capabilities'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['capabilities'] ) : $_POST['capabilities'] ) : array();\r\n        \r\n        $user_roles = new User_Roles();\r\n        $result = $user_roles->update_role_capabilities( $role_slug, $capabilities );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create new role.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function create_role() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_create_role' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $role_name = isset( $_POST['role_name'] ) ? sanitize_text_field( $_POST['role_name'] ) : '';\r\n        $role_slug = isset( $_POST['role_slug'] ) ? sanitize_text_field( $_POST['role_slug'] ) : '';\r\n        $capabilities = isset( $_POST['capabilities'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['capabilities'] ) : $_POST['capabilities'] ) : array();\r\n        \r\n        $user_roles = new User_Roles();\r\n        $result = $user_roles->create_role( $role_slug, $role_name, $capabilities );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete role.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function delete_role() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_delete_role' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $role_slug = isset( $_POST['role_slug'] ) ? sanitize_text_field( $_POST['role_slug'] ) : '';\r\n        \r\n        $user_roles = new User_Roles();\r\n        $result = $user_roles->delete_role( $role_slug );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Duplicate role.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function duplicate_role() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_duplicate_role' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $role_slug = isset( $_POST['role_slug'] ) ? sanitize_text_field( $_POST['role_slug'] ) : '';\r\n        $new_role_name = isset( $_POST['new_role_name'] ) ? sanitize_text_field( $_POST['new_role_name'] ) : '';\r\n        $new_role_slug = isset( $_POST['new_role_slug'] ) ? sanitize_text_field( $_POST['new_role_slug'] ) : '';\r\n        \r\n        $user_roles = new User_Roles();\r\n        $result = $user_roles->duplicate_role( $role_slug, $new_role_name, $new_role_slug );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get menu items.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_menu_items() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_menu_items' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $menu_manager = new Menu_Manager();\r\n        $menu_items = $menu_manager->get_menu_items();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $menu_items );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save menu items.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function save_menu_items() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_save_menu_items' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $menu_items = isset( $_POST['menu_items'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['menu_items'] ) : $_POST['menu_items'] ) : array();\r\n        \r\n        $menu_manager = new Menu_Manager();\r\n        $result = $menu_manager->save_menu_items( $menu_items );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Optimize database.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function optimize_database() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_optimize_database' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $database = new Database();\r\n        $result = $database->optimize_database();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear cache.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function clear_cache() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_clear_cache' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $performance = new Performance();\r\n        $result = $performance->clear_cache();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get performance statistics.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_performance_stats() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_performance_stats' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $performance = new Performance();\r\n        $stats = $performance->get_performance_stats();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $stats );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset plugin.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function reset_plugin() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_reset_plugin' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $reset = new Reset();\r\n        $result = $reset->reset_plugin();\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get database information.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_database_info() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_database_info' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $database = new Database();\r\n        $info = $database->get_database_info();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $info );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Backup database.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function backup_database() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_backup_database' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $options = isset( $_POST['options'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['options'] ) : $_POST['options'] ) : array();\r\n        \r\n        $database = new Database();\r\n        $result = $database->backup_database( $options );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore database.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function restore_database() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_restore_database' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $backup_file = isset( $_POST['backup_file'] ) ? sanitize_text_field( $_POST['backup_file'] ) : '';\r\n        \r\n        $database = new Database();\r\n        $result = $database->restore_database( $backup_file );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get database backups.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_database_backups() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_database_backups' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $database = new Database();\r\n        $backups = $database->get_database_backups();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $backups );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete database backup.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function delete_database_backup() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_delete_database_backup' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $backup_file = isset( $_POST['backup_file'] ) ? sanitize_text_field( $_POST['backup_file'] ) : '';\r\n        \r\n        $database = new Database();\r\n        $result = $database->delete_database_backup( $backup_file );\r\n        \r\n        if ( $result['success'] ) {\r\n            if ( function_exists( '\wp_send_json_success' ) ) {\r\n                \wp_send_json_success( $result );\r\n            }\r\n        } else {\r\n            if ( function_exists( '\wp_send_json_error' ) ) {\r\n                \wp_send_json_error( $result['message'] );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get resources statistics.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_resources_stats() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_resources_stats' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $resources = new Resources();\r\n        $stats = $resources->get_resources_stats();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $stats );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get resource details.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_resource_details() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_resource_details' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $type = isset( $_POST['type'] ) ? sanitize_text_field( $_POST['type'] ) : '';\r\n        \r\n        $resources = new Resources();\r\n        $details = $resources->get_resource_details( $type );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $details );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Optimize resources.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function optimize_resources() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_optimize_resources' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $options = isset( $_POST['options'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['options'] ) : $_POST['options'] ) : array();\r\n        \r\n        $resources = new Resources();\r\n        $result = $resources->optimize_resources( $options );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable resource.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function disable_resource() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_disable_resource' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $type = isset( $_POST['type'] ) ? sanitize_text_field( $_POST['type'] ) : '';\r\n        $handle = isset( $_POST['handle'] ) ? sanitize_text_field( $_POST['handle'] ) : '';\r\n        \r\n        $resources = new Resources();\r\n        $result = $resources->disable_resource( $type, $handle );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable resource.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function enable_resource() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_enable_resource' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $type = isset( $_POST['type'] ) ? sanitize_text_field( $_POST['type'] ) : '';\r\n        $handle = isset( $_POST['handle'] ) ? sanitize_text_field( $_POST['handle'] ) : '';\r\n        \r\n        $resources = new Resources();\r\n        $result = $resources->enable_resource( $type, $handle );\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $result );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save menu customizer settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function save_menu_customizer_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_save_menu_customizer_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $settings = isset( $_POST['settings'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['settings'] ) : $_POST['settings'] ) : array();\r\n        \r\n        $menu_customizer = new Menu_Customizer();\r\n        $result = $menu_customizer->save_settings( $settings );\r\n        \r\n        if ( $result ) {\r\n            \wp_send_json_success( array( 'message' => \__( 'Menu customizer settings saved successfully', WPCA_TEXT_DOMAIN ) ) );\r\n        } else {\r\n            \wp_send_json_error( \__( 'Failed to save menu customizer settings', WPCA_TEXT_DOMAIN ) );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get menu customizer settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_menu_customizer_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_menu_customizer_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $menu_customizer = new Menu_Customizer();\r\n        $settings = $menu_customizer->get_settings();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $settings );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset menu customizer settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function reset_menu_customizer_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_reset_menu_customizer_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $menu_customizer = new Menu_Customizer();\r\n        $result = $menu_customizer->reset_settings();\r\n        \r\n        if ( $result ) {\r\n            \wp_send_json_success( array( 'message' => \__( 'Menu customizer settings reset to default', WPCA_TEXT_DOMAIN ) ) );\r\n        } else {\r\n            \wp_send_json_error( \__( 'Failed to reset menu customizer settings', WPCA_TEXT_DOMAIN ) );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save database settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function save_database_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_save_database_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $settings = isset( $_POST['settings'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['settings'] ) : $_POST['settings'] ) : array();\r\n        \r\n        $database_settings = new Database_Settings();\r\n        $result = $database_settings->save_settings( $settings );\r\n        \r\n        if ( $result ) {\r\n            \wp_send_json_success( array( 'message' => \__( 'Database settings saved successfully', WPCA_TEXT_DOMAIN ) ) );\r\n        } else {\r\n            \wp_send_json_error( \__( 'Failed to save database settings', WPCA_TEXT_DOMAIN ) );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get database settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_database_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_database_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $database_settings = new Database_Settings();\r\n        $settings = $database_settings->get_settings();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $settings );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset database settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function reset_database_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_reset_database_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $database_settings = new Database_Settings();\r\n        $result = $database_settings->reset_settings();\r\n        \r\n        if ( $result ) {\r\n            \wp_send_json_success( array( 'message' => \__( 'Database settings reset to default', WPCA_TEXT_DOMAIN ) ) );\r\n        } else {\r\n            \wp_send_json_error( \__( 'Failed to reset database settings', WPCA_TEXT_DOMAIN ) );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save performance settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function save_performance_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_save_performance_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $settings = isset( $_POST['settings'] ) ? ( function_exists( '\wp_unslash' ) ? \wp_unslash( $_POST['settings'] ) : $_POST['settings'] ) : array();\r\n        \r\n        $performance_settings = new Performance_Settings();\r\n        $result = $performance_settings->save_settings( $settings );\r\n        \r\n        if ( $result ) {\r\n            \wp_send_json_success( array( 'message' => \__( 'Performance settings saved successfully', WPCA_TEXT_DOMAIN ) ) );\r\n        } else {\r\n            \wp_send_json_error( \__( 'Failed to save performance settings', WPCA_TEXT_DOMAIN ) );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get performance settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function get_performance_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_get_performance_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $performance_settings = new Performance_Settings();\r\n        $settings = $performance_settings->get_settings();\r\n        if ( function_exists( '\wp_send_json_success' ) ) {\r\n            \wp_send_json_success( $settings );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset performance settings.\r\n     *\r\n     * @since 1.7.15\r\n     */\r\n    public function reset_performance_settings() {\r\n        if ( ! $this->verify_ajax_request( 'wpca_reset_performance_settings' ) ) {\r\n            return;\r\n        }\r\n        \r\n        $performance_settings = new Performance_Settings();\r\n        $result = $performance_settings->reset_settings();\r\n        \r\n        if ( $result ) {\r\n            \wp_send_json_success( array( 'message' => \__( 'Performance settings reset to default', WPCA_TEXT_DOMAIN ) ) );\r\n        } else {\r\n            \wp_send_json_error( \__( 'Failed to reset performance settings', WPCA_TEXT_DOMAIN ) );\r\n        }\r\n    }\r\n}