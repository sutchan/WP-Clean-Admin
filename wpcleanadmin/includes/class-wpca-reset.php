<?php\r\n/**\r\n * WPCleanAdmin Reset Class\r\n *\r\n * @package WPCleanAdmin\r\n * @version 1.7.15\r\n * @author Sut\r\n * @author URI: https://github.com/sutchan\r\n * @since 1.7.15\r\n */\r\nnamespace WPCleanAdmin;\r\n\r\nif ( ! defined( 'ABSPATH' ) ) {\r\n    exit;\r\n}\r\n\r\n/**\r\n * Reset class\r\n */\r\nclass Reset {\r\n    \r\n    /**\r\n     * Singleton instance\r\n     *\r\n     * @var Reset\r\n     */\r\n    private static $instance;\r\n    \r\n    /**\r\n     * Get singleton instance\r\n     *\r\n     * @return Reset\r\n     */\r\n    public static function getInstance() {\r\n        if ( ! isset( self::$instance ) ) {\r\n            self::$instance = new self();\r\n        }\r\n        return self::$instance;\r\n    }\r\n    \r\n    /**\r\n     * Constructor\r\n     */\r\n    private function __construct() {\r\n        $this->init();\r\n    }\r\n    \r\n    /**\r\n     * Initialize the reset module\r\n     */\r\n    public function init() {\r\n        // Add reset hooks\r\n        \add_action( 'wpca_reset_settings', array( $this, 'reset_settings' ) );\r\n        \add_action( 'wpca_reset_plugin', array( $this, 'reset_plugin' ) );\r\n    }\r\n    \r\n    /**\r\n     * Reset plugin settings\r\n     *\r\n     * @return array Reset results\r\n     */\r\n    public function reset_settings() {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Settings reset successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Delete all plugin options\r\n        $options = array(\r\n            'wpca_settings',\r\n            'wpca_menu_customizer_settings',\r\n            'wpca_menu_items',\r\n            'wpca_login_attempts_*'\r\n        );\r\n        \r\n        foreach ( $options as $option ) {\r\n            if ( strpos( $option, '*' ) !== false ) {\r\n                // Delete all options matching the pattern\r\n                global $wpdb;\r\n                $pattern = str_replace( '*', '%', $option );\r\n                $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option_name LIKE %s", $pattern ) );\r\n            } else {\r\n                // Delete specific option\r\n                \delete_option( $option );\r\n            }\r\n        }\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Reset plugin completely\r\n     *\r\n     * @return array Reset results\r\n     */\r\n    public function reset_plugin() {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Plugin reset successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Reset settings\r\n        $settings_result = $this->reset_settings();\r\n        \r\n        if ( ! $settings_result['success'] ) {\r\n            $results['success'] = false;\r\n            $results['message'] = $settings_result['message'];\r\n            return $results;\r\n        }\r\n        \r\n        // Remove scheduled events\r\n        $events = array(\r\n            'wpca_optimize_database',\r\n            'wpca_clean_transients'\r\n        );\r\n        \r\n        foreach ( $events as $event ) {\r\n            $timestamp = ( function_exists( '\wp_next_scheduled' ) ? \wp_next_scheduled( $event ) : false );\r\n            if ( $timestamp && function_exists( '\wp_unschedule_event' ) ) {\r\n                \wp_unschedule_event( $timestamp, $event );\r\n            }\r\n        }\r\n        \r\n        // Remove custom roles\r\n        $settings = wpca_get_settings();\r\n        \r\n        if ( isset( $settings['user_roles'] ) && isset( $settings['user_roles']['custom_roles'] ) ) {\r\n            foreach ( $settings['user_roles']['custom_roles'] as $role_slug => $role_data ) {\r\n                if ( function_exists( '\remove_role' ) ) {\r\n                    \remove_role( $role_slug );\r\n                }\r\n            }\r\n        }\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Reset specific module settings\r\n     *\r\n     * @param string $module Module name\r\n     * @return array Reset results\r\n     */\r\n    public function reset_module_settings( $module ) {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => sprintf( \__( '%s module settings reset successfully', WPCA_TEXT_DOMAIN ), ucfirst( $module ) )\r\n        );\r\n        \r\n        // Get all settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        // Reset specific module settings\r\n        if ( isset( $settings[$module] ) ) {\r\n            unset( $settings[$module] );\r\n            \update_option( 'wpca_settings', $settings );\r\n        } else {\r\n            $results['success'] = false;\r\n            $results['message'] = sprintf( \__( 'Invalid module: %s', WPCA_TEXT_DOMAIN ), $module );\r\n        }\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Reset dashboard widgets\r\n     *\r\n     * @return array Reset results\r\n     */\r\n    public function reset_dashboard_widgets() {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Dashboard widgets reset successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Delete dashboard widget settings\r\n        \delete_option( 'wp_user_dashboard_widgets' );\r\n        \delete_option( 'dashboard_widget_options' );\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Reset admin menu\r\n     *\r\n     * @return array Reset results\r\n     */\r\n    public function reset_admin_menu() {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Admin menu reset successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Delete admin menu settings\r\n        \delete_option( 'wpca_menu_items' );\r\n        \delete_option( 'wpca_menu_customizer_settings' );\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Reset login settings\r\n     *\r\n     * @return array Reset results\r\n     */\r\n    public function reset_login_settings() {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Login settings reset successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Get all settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        // Reset login settings\r\n        if ( isset( $settings['login'] ) ) {\r\n            unset( $settings['login'] );\r\n            \update_option( 'wpca_settings', $settings );\r\n        }\r\n        \r\n        // Delete login attempt transients\r\n        global $wpdb;\r\n        $wpdb->query( "DELETE FROM {$wpdb->options} WHERE option_name LIKE 'wpca_login_attempts_%'" );\r\n        \r\n        return $results;\r\n    }\r\n    \r\n    /**\r\n     * Reset performance settings\r\n     *\r\n     * @return array Reset results\r\n     */\r\n    public function reset_performance_settings() {\r\n        $results = array(\r\n            'success' => true,\r\n            'message' => \__( 'Performance settings reset successfully', WPCA_TEXT_DOMAIN )\r\n        );\r\n        \r\n        // Get all settings\r\n        $settings = wpca_get_settings();\r\n        \r\n        // Reset performance settings\r\n        if ( isset( $settings['performance'] ) ) {\r\n            unset( $settings['performance'] );\r\n            \update_option( 'wpca_settings', $settings );\r\n        }\r\n        \r\n        // Remove scheduled performance events\r\n        $events = array(\r\n            'wpca_optimize_database',\r\n            'wpca_clean_transients'\r\n        );\r\n        \r\n        foreach ( $events as $event ) {\r\n            $timestamp = ( function_exists( '\wp_next_scheduled' ) ? \wp_next_scheduled( $event ) : false );\r\n            if ( $timestamp && function_exists( '\wp_unschedule_event' ) ) {\r\n                \wp_unschedule_event( $timestamp, $event );\r\n            }\r\n        }\r\n        \r\n        return $results;\r\n    }\r\n}