<?php\n/**\n * WP Clean Admin Cleanup Class\n *\n * Handles various cleanup tasks in the WordPress admin area.\n *\n * @package WP_Clean_Admin\n * @version 1.7.13\n * @file wpcleanadmin/includes/class-wpca-cleanup.php\n * @updated 2025-06-18\n */\n\nif (!defined('ABSPATH')) {\n    exit; // Exit if accessed directly.\n}\n\nclass WPCA_Cleanup {\n\n    /**\n     * Constructor.\n     */\n    public function __construct() {\n        // Enqueue cleanup specific styles/scripts.\n        if (function_exists('add_action')) {\n            add_action('admin_enqueue_scripts', [$this, 'enqueue_cleanup_assets']);\n\n            // Remove unnecessary admin features based on settings.\n            add_action('admin_init', [$this, 'remove_unnecessary_features']);\n\n            // Remove specific menu items for non-admin users.\n            add_action('admin_menu', [$this, 'remove_menu_items_for_non_admins'], 999);\n        }\n    }\n\n    /**\n     * Enqueue cleanup-specific assets.\n     */\n    public function enqueue_cleanup_assets() {\n        // Currently no specific assets for cleanup, but can be added here if needed.\n    }\n\n    /**\n     * Remove unnecessary admin features.\n     */\n    public function remove_unnecessary_features() {\n        if (class_exists('WPCA_Settings') && method_exists('WPCA_Settings', 'get_options')) {\n            $options = WPCA_Settings::get_options();\n\n            // Hide screen options tab\n            if (isset($options['hide_screen_options']) && $options['hide_screen_options'] && function_exists('add_filter')) {\n                add_filter('screen_options_show_screen', '__return_false');\n            }\n\n            // Hide help tab\n            if (isset($options['hide_help_tab']) && $options['hide_help_tab'] && function_exists('add_filter')) {\n                add_filter('contextual_help', [$this, 'remove_help_tab'], 999, 3);\n            }\n\n            // Remove WordPress logo from admin bar\n            if (isset($options['hide_wp_logo']) && $options['hide_wp_logo'] && function_exists('add_action')) {\n                add_action('admin_bar_menu', [$this, 'remove_wp_logo_from_admin_bar'], 999);\n            }\n\n            // Disable comments\n            if (isset($options['disable_comments']) && $options['disable_comments']) {\n                $this->disable_comments_globally();\n            }\n\n            // Remove update notices for non-admin users\n            if (isset($options['hide_update_notices']) && $options['hide_update_notices'] && function_exists('add_action')) {\n                add_action('admin_head', [$this, 'hide_update_notices_for_non_admins'], 1);\n            }\n            \n            // Hide WordPress footer\n            if (isset($options['hide_wpfooter']) && $options['hide_wpfooter'] && function_exists('add_action')) {\n                add_action('admin_head', [$this, 'hide_wordpress_footer']);\n            }\n            \n            // Hide frontend admin bar\n            if (isset($options['hide_frontend_adminbar']) && $options['hide_frontend_adminbar'] && function_exists('add_filter')) {\n                add_filter('show_admin_bar', '__return_false');\n            }\n        }\n    }\n\n    /**\n     * Remove the help tab.\n     */\n    public function remove_help_tab($old_help, $screen_id, $screen) {\n        if (isset($screen) && method_exists($screen, 'remove_help_tabs')) {\n            $screen->remove_help_tabs();\n        }\n        return $old_help;\n    }\n\n    /**\n     * Remove WordPress logo from admin bar.\n     */\n    public function remove_wp_logo_from_admin_bar($wp_admin_bar) {\n        if (isset($wp_admin_bar) && method_exists($wp_admin_bar, 'remove_node')) {\n            $wp_admin_bar->remove_node('wp-logo');\n        }\n    }\n\n    /**\n     * Disable comments globally.\n     */\n    private function disable_comments_globally() {\n        // Redirect any user trying to access comments page\n        if (function_exists('add_action')) {\n            add_action('admin_init', function () {\n                global $pagenow;\n                if ($pagenow === 'edit-comments.php' && function_exists('wp_redirect') && function_exists('admin_url')) {\n                    wp_redirect(admin_url());\n                    exit;\n                }\n                // Remove comments metabox from dashboard\n                if (function_exists('remove_meta_box')) {\n                    remove_meta_box('dashboard_recent_comments', 'dashboard', 'normal');\n                }\n                // Disable comments on posts and pages\n                if (function_exists('remove_post_type_support')) {\n                    remove_post_type_support('post', 'comments');\n                    remove_post_type_support('page', 'comments');\n                }\n            });\n\n            // Close comments on the frontend\n            if (function_exists('add_filter')) {\n                add_filter('comments_open', '__return_false', 20, 2);\n                add_filter('pings_open', '__return_false', 20, 2);\n\n                // Hide existing comments\n                add_filter('comments_array', '__return_empty_array', 10, 2);\n            }\n\n            // Remove comments link from admin menu\n            if (function_exists('add_action')) {\n                add_action('admin_menu', function () {\n                    if (function_exists('remove_menu_page')) {\n                        remove_menu_page('edit-comments.php');\n                    }\n                });\n            }\n\n            // Remove comments link from admin bar\n            if (function_exists('add_action')) {\n                add_action('wp_before_admin_bar_render', function () {\n                    global $wp_admin_bar;\n                    if (isset($wp_admin_bar) && method_exists($wp_admin_bar, 'remove_menu')) {\n                        $wp_admin_bar->remove_menu('comments');\n                    }\n                });\n            }\n        }\n    }\n\n    /**\n     * Remove specific menu items for non-admin users.\n     */\n    public function remove_menu_items_for_non_admins() {\n        if (function_exists('current_user_can') && !current_user_can('manage_options')) {\n            // Example: remove Tools menu for non-admin users\n            // if (function_exists('remove_menu_page')) {\n            //     remove_menu_page('tools.php');\n            //     remove_submenu_page('options-general.php', 'options-writing.php');\n            // }\n        }\n    }\n\n    /**\n     * Hide update notices for non-admin users.\n     */\n    public function hide_update_notices_for_non_admins() {\n        if (function_exists('current_user_can') && !current_user_can('update_core') && function_exists('remove_action')) {\n            remove_action('admin_notices', 'update_nag', 3);\n            \n            // Remove the WordPress SEO update notices if Yoast SEO is active\n            if (function_exists('remove_action')) {\n                remove_action('admin_notices', array('Yoast_Notification_Center', 'display_notifications'));\n                remove_action('all_admin_notices', array('Yoast_Notification_Center', 'display_notifications'));\n            }\n        }\n    }\n    \n    /**\n     * Hide WordPress footer\n     */\n    public function hide_wordpress_footer() {\n        ?>\n        <style type="text/css">\n            #wpfooter {\n                display: none !important;\n            }\n        </style>\n        <?php\n    }\n}\n?>