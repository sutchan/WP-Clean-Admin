# 开发者指南

## 1. 概述

### 1.1 文档目的

本指南旨在帮助开发者快速了解 WP Clean Admin 项目的开发环境、目录结构、编码规范和开发流程，以便能够顺利参与项目开发和贡献代码。

### 1.2 项目简介

WP Clean Admin 是一个 WordPress 插件，用于管理和优化 WordPress 后台，提供菜单清理、性能优化、样式定制等功能，帮助用户打造简洁、高效、安全的 WordPress 后台环境。

### 1.3 技术栈

| 技术领域 | 技术栈 | 版本要求 |
|----------|--------|----------|
| 核心语言 | PHP | 7.0+ |
| 前端语言 | JavaScript | ES6+ |
| 样式语言 | CSS | 3+ |
| 框架 | WordPress | 5.0+ |
| 构建工具 | Webpack | 5.x |
| 包管理器 | Composer | 2.x |
| 测试框架 | PHPUnit | 9.x |
| 代码规范 | WPCS | 3.x |

## 2. 开发环境搭建

### 2.1 本地开发环境

1. **安装 WordPress**：
   - 推荐使用 Local by Flywheel、XAMPP、WAMP 或 MAMP 搭建本地 WordPress 环境
   - 确保 WordPress 版本符合要求（5.0+）
   - 确保 PHP 版本符合要求（7.0+）

2. **安装 Git**：
   - 从 [Git 官网](https://git-scm.com/) 下载并安装 Git
   - 配置 Git 用户名和邮箱：
     ```bash
     git config --global user.name "Your Name"
     git config --global user.email "your.email@example.com"
     ```

3. **克隆仓库**：
   ```bash
   git clone https://github.com/sutchan/WP-Clean-Admin.git
   cd WPCleanAdmin
   ```

4. **安装依赖**：
   ```bash
   # 安装 PHP 依赖
   composer install
   
   # 安装 JavaScript 依赖（如果有）
   npm install
   ```

5. **配置开发环境**：
   - 将插件目录复制到本地 WordPress 安装的 `wp-content/plugins/` 目录
   - 或创建符号链接：
     ```bash
     ln -s /path/to/WPCleanAdmin /path/to/wordpress/wp-content/plugins/wp-clean-admin
     ```

6. **激活插件**：
   - 登录 WordPress 后台
   - 进入「插件」→「已安装插件」
   - 找到 WP Clean Admin 插件，点击「激活」

### 2.2 开发工具

1. **代码编辑器**：
   - 推荐使用 VS Code，安装以下扩展：
     - PHP Intelephense
     - WordPress Snippets
     - ESLint
     - Prettier
     - GitLens

2. **调试工具**：
   - Debug Bar（WordPress 插件）
   - Query Monitor（WordPress 插件）
   - Xdebug（PHP 扩展）

3. **命令行工具**：
   - WP CLI
   - Composer
   - npm/yarn

## 3. 目录结构

### 3.1 项目目录结构

```
wpcleanadmin/
├── assets/                    # 静态资源目录
│   ├── css/                   # CSS 文件
│   └── js/                    # JavaScript 文件
├── includes/                  # 核心功能目录
│   ├── autoload.php           # 自动加载文件
│   ├── class-*.php            # 各个功能类
│   └── wpca-core-functions.php # 核心函数
├── languages/                 # 语言文件目录
├── docs/                      # 项目文档
├── tests/                     # 测试文件
├── vendor/                    # Composer 依赖
├── .gitignore                 # Git 忽略文件
├── composer.json              # Composer 配置
├── package.json               # npm 配置
├── phpcs.xml                  # PHP 代码规范配置
├── webpack.config.js          # Webpack 配置
└── wp-clean-admin.php         # 插件主文件
```

### 3.2 目录说明

| 目录/文件 | 说明 |
|----------|------|
| `assets/` | 存放静态资源文件，包括 CSS、JavaScript、图片等 |
| `includes/` | 存放插件核心功能代码，包括类文件和函数文件 |
| `languages/` | 存放多语言文件，包括 .pot、.po 和 .mo 文件 |
| `docs/` | 存放项目文档，包括使用指南、开发指南等 |
| `tests/` | 存放测试文件，包括单元测试和集成测试 |
| `vendor/` | 存放 Composer 依赖包 |
| `wp-clean-admin.php` | 插件主文件，包含插件的元数据和初始化代码 |
| `composer.json` | Composer 配置文件，定义项目依赖和脚本 |
| `package.json` | npm 配置文件，定义前端依赖和构建脚本 |
| `phpcs.xml` | PHP 代码规范配置文件，用于代码检查 |
| `webpack.config.js` | Webpack 配置文件，用于前端资源构建 |

## 4. 编码规范

### 4.1 PHP 编码规范

1. **遵循 WordPress 编码规范**：
   - 使用 4 个空格作为缩进，禁止使用制表符
   - 每行代码长度不超过 120 个字符
   - 使用 `<?php` 标签，禁止使用短标签 `<?`
   - PHP 文件末尾禁止使用闭合标签 `?>`
   - 类名使用 PascalCase，例如 `WPCleanAdmin\Core`
   - 方法名使用 camelCase，例如 `getInstance()`
   - 函数名使用 snake_case，例如 `wpca_get_settings()`
   - 变量名使用 snake_case，例如 `$plugin_settings`
   - 常量名使用全大写字母和下划线，例如 `WPCA_VERSION`

2. **命名空间**：
   ```php
   namespace WPCleanAdmin;
   
   class Core {
       // 类代码
   }
   ```

3. **自动加载**：
   - 遵循 PSR-4 自动加载规范
   - 在 `includes/autoload.php` 中定义自动加载规则

4. **注释规范**：
   - 使用 PHPDoc 注释类、方法和函数
   - 为复杂代码添加行内注释
   - 注释使用中文

   ```php
   /**
    * 核心类，负责插件的初始化和管理
    *
    * @package WPCleanAdmin
    * @since 1.0.0
    */
   class Core {
       /**
        * 获取单例实例
        *
        * @return Core 单例实例
        * @since 1.0.0
        */
       public static function getInstance() {
           // 方法代码
       }
   }
   ```

### 4.2 JavaScript 编码规范

1. **变量声明**：
   - 使用 `const` 或 `let`，禁止使用 `var`
   - 变量名使用 camelCase，例如 `pluginSettings`

2. **函数声明**：
   - 使用箭头函数或函数表达式
   - 函数名使用 camelCase，例如 `initPlugin()`

3. **代码风格**：
   - 使用 2 个空格作为缩进
   - 每行代码长度不超过 120 个字符
   - 必须使用分号结束语句
   - 字符串使用单引号 `'`

4. **注释规范**：
   - 使用 JSDoc 注释函数和类
   - 为复杂代码添加行内注释
   - 注释使用中文

   ```javascript
   /**
    * 初始化插件
    * @since 1.0.0
    */
   const initPlugin = () => {
       // 初始化代码
   };
   ```

### 4.3 CSS 编码规范

1. **命名规范**：
   - 使用 BEM（Block Element Modifier）命名规范
   - 例如：`.wpca-menu__item--active`

2. **代码风格**：
   - 使用 2 个空格作为缩进
   - 每行代码长度不超过 120 个字符
   - 选择器使用小写字母，单词之间用连字符 `-` 分隔
   - 属性名使用小写字母，单词之间用连字符 `-` 分隔

3. **注释规范**：
   - 为每个组件添加注释
   - 注释使用中文

   ```css
   /* 菜单组件 */
   .wpca-menu {
       display: flex;
       flex-direction: column;
   }
   
   /* 菜单项 */
   .wpca-menu__item {
       padding: 10px;
   }
   
   /* 激活状态的菜单项 */
   .wpca-menu__item--active {
       background-color: #007cba;
       color: white;
   }
   ```

## 5. 开发流程

### 5.1 分支管理

1. **分支策略**：
   - **main**：主分支，用于发布稳定版本
   - **develop**：开发分支，用于集成新功能
   - **feature/xxx**：功能分支，用于开发新功能
   - **bugfix/xxx**：修复分支，用于修复 bug

2. **分支命名规则**：
   - 功能分支：`feature/功能名称`，例如 `feature/menu-cleanup`
   - 修复分支：`bugfix/问题描述`，例如 `bugfix/fix-menu-display`

### 5.2 开发流程

1. **创建分支**：
   ```bash
   # 从 develop 分支创建功能分支
   git checkout develop
   git pull origin develop
   git checkout -b feature/功能名称
   ```

2. **开发代码**：
   - 遵循编码规范
   - 编写测试用例
   - 更新文档

3. **代码检查**：
   ```bash
   # 运行 PHP 代码规范检查
   composer run phpcs
   
   # 运行 JavaScript 代码规范检查
   npm run eslint
   ```

4. **运行测试**：
   ```bash
   # 运行 PHP 单元测试
   composer run test
   
   # 运行 JavaScript 测试
   npm run test
   ```

5. **提交代码**：
   ```bash
   # 添加修改的文件
   git add .
   
   # 提交代码，使用 Conventional Commits 规范
   git commit -m "feat(menu): 添加菜单清理功能"
   ```

6. **推送分支**：
   ```bash
   git push origin feature/功能名称
   ```

7. **创建 Pull Request**：
   - 登录 GitHub
   - 进入项目仓库
   - 点击「New Pull Request」
   - 选择源分支和目标分支（通常是 develop）
   - 填写 PR 描述，包括功能说明、修改内容、测试结果等
   - 提交 PR

### 5.3 提交信息规范

使用 Conventional Commits 规范，格式为：

```
type(scope): description

[optional body]

[optional footer(s)]
```

**类型（type）**：
- `feat`：新功能
- `fix`：bug 修复
- `docs`：文档更新
- `style`：代码风格修改（不影响功能）
- `refactor`：代码重构（不影响功能）
- `test`：测试相关修改
- `chore`：构建过程或辅助工具的变动

**范围（scope）**：
- 功能模块名称，例如 `menu`、`performance`、`style`

**描述（description）**：
- 简短描述修改内容，使用祈使句，首字母小写，不使用句号结尾

**示例**：
```
feat(menu): 添加菜单可视化管理功能

fix(performance): 修复后台加载缓慢问题

docs(guide): 更新开发者指南
```

## 6. 测试指南

### 6.1 测试类型

1. **单元测试**：
   - 测试单个函数或方法
   - 使用 PHPUnit 进行测试
   - 测试文件存放在 `tests/unit/` 目录

2. **集成测试**：
   - 测试多个模块之间的交互
   - 使用 PHPUnit 和 WP CLI 进行测试
   - 测试文件存放在 `tests/integration/` 目录

3. **功能测试**：
   - 测试完整的功能流程
   - 使用 WP CLI 或浏览器自动化测试
   - 测试文件存放在 `tests/functional/` 目录

### 6.2 运行测试

1. **运行所有测试**：
   ```bash
   composer run test
   ```

2. **运行特定类型的测试**：
   ```bash
   # 运行单元测试
   composer run test:unit
   
   # 运行集成测试
   composer run test:integration
   
   # 运行功能测试
   composer run test:functional
   ```

3. **运行单个测试文件**：
   ```bash
   vendor/bin/phpunit tests/unit/TestCore.php
   ```

### 6.3 编写测试用例

1. **单元测试示例**：
   ```php
   <?php
   
   use PHPUnit\Framework\TestCase;
   use WPCleanAdmin\Core;
   
   class TestCore extends TestCase {
       /**
        * 测试单例模式
        */
       public function testSingleton() {
           $instance1 = Core::getInstance();
           $instance2 = Core::getInstance();
           
           $this->assertSame($instance1, $instance2);
       }
       
       /**
        * 测试插件初始化
        */
       public function testInit() {
           $core = Core::getInstance();
           $this->assertTrue($core->init());
       }
   }
   ```

## 7. 贡献指南

### 7.1 如何贡献

1. **Fork 仓库**：
   - 登录 GitHub
   - 进入项目仓库 https://github.com/sutchan/WP-Clean-Admin
   - 点击「Fork」按钮，创建自己的 Fork

2. **克隆 Fork**：
   ```bash
   git clone https://github.com/your-username/WPCleanAdmin.git
   cd WPCleanAdmin
   ```

3. **添加上游仓库**：
   ```bash
   git remote add upstream https://github.com/sutchan/WP-Clean-Admin.git
   ```

4. **创建分支**：
   ```bash
   git checkout develop
   git pull upstream develop
   git checkout -b feature/功能名称
   ```

5. **开发代码**：
   - 遵循编码规范
   - 编写测试用例
   - 更新文档

6. **提交代码**：
   ```bash
   git add .
   git commit -m "feat(menu): 添加菜单清理功能"
   ```

7. **推送分支**：
   ```bash
   git push origin feature/功能名称
   ```

8. **创建 Pull Request**：
   - 登录 GitHub
   - 进入你的 Fork 仓库
   - 点击「New Pull Request」
   - 选择源分支和目标分支（通常是 upstream/develop）
   - 填写 PR 描述，包括功能说明、修改内容、测试结果等
   - 提交 PR

### 7.2 贡献要求

1. **代码质量**：
   - 遵循项目编码规范
   - 编写清晰、可维护的代码
   - 添加适当的注释

2. **测试**：
   - 为新功能编写测试用例
   - 确保所有测试通过
   - 提高测试覆盖率

3. **文档**：
   - 更新相关文档
   - 保持文档与代码同步

4. **兼容性**：
   - 确保代码兼容 WordPress 5.0+ 和 PHP 7.0+
   - 避免使用过时的 API

### 7.3 代码审查

1. **审查流程**：
   - PR 提交后，项目维护者会进行代码审查
   - 审查者可能会提出修改建议
   - 开发者需要根据建议修改代码
   - 修改完成后，重新提交代码

2. **审查标准**：
   - 代码质量和可读性
   - 功能正确性和完整性
   - 测试覆盖率
   - 兼容性和安全性
   - 文档完整性

## 8. 多语言支持

### 8.1 国际化（i18n）

1. **使用 WordPress 翻译函数**：
   ```php
   // 翻译文本
   __('文本内容', 'wp-clean-admin');
   
   // 翻译并回显文本
   _e('文本内容', 'wp-clean-admin');
   
   // 翻译带上下文的文本
   _x('文本内容', '上下文', 'wp-clean-admin');
   
   // 翻译复数形式
   _n('单数形式', '复数形式', $count, 'wp-clean-admin');
   ```

2. **更新 POT 文件**：
   ```bash
   # 使用 WP CLI 生成 POT 文件
   wp i18n make-pot . languages/wp-clean-admin.pot --exclude=vendor,docs,tests
   ```

### 8.2 本地化（l10n）

1. **创建翻译文件**：
   - 使用 Poedit 或其他翻译工具打开 POT 文件
   - 翻译所有字符串
   - 保存为 `.po` 文件，例如 `languages/wp-clean-admin-zh_CN.po`
   - 生成 `.mo` 文件

2. **添加新语言支持**：
   - 将翻译文件上传到 `languages/` 目录
   - 在 WordPress 后台设置中切换语言

## 9. 常见问题

### 9.1 如何调试插件？

1. **启用 WordPress 调试模式**：
   在 `wp-config.php` 中添加：
   ```php
   define( 'WP_DEBUG', true );
   define( 'WP_DEBUG_DISPLAY', true );
   define( 'WP_DEBUG_LOG', true );
   ```

2. **使用调试插件**：
   - Debug Bar
   - Query Monitor

3. **使用 Xdebug**：
   - 配置 Xdebug
   - 在 VS Code 中设置断点
   - 启动调试

### 9.2 如何处理数据库操作？

1. **使用 WordPress 数据库类**：
   ```php
   global $wpdb;
   $results = $wpdb->get_results( $wpdb->prepare( "SELECT * FROM {$wpdb->posts} WHERE post_type = %s", 'post' ) );
   ```

2. **使用自定义表**：
   ```php
   // 创建自定义表
   function wpca_create_table() {
       global $wpdb;
       $table_name = $wpdb->prefix . 'wpca_settings';
       $charset_collate = $wpdb->get_charset_collate();
       
       $sql = "CREATE TABLE $table_name (
           id mediumint(9) NOT NULL AUTO_INCREMENT,
           name varchar(255) NOT NULL,
           value text NOT NULL,
           PRIMARY KEY  (id)
       ) $charset_collate;";
       
       require_once( ABSPATH . 'wp-admin/includes/upgrade.php' );
       dbDelta( $sql );
   }
   register_activation_hook( __FILE__, 'wpca_create_table' );
   ```

### 9.3 如何添加新功能模块？

1. **创建类文件**：
   在 `includes/` 目录下创建新的类文件，例如 `class-wpca-new-feature.php`

2. **定义类**：
   ```php
   namespace WPCleanAdmin;
   
   class NewFeature {
       // 类代码
   }
   ```

3. **在自动加载中注册**：
   在 `includes/autoload.php` 中添加自动加载规则

4. **在主文件中初始化**：
   在 `wp-clean-admin.php` 中初始化新功能类

## 10. 总结

本指南涵盖了 WP Clean Admin 项目的开发环境、目录结构、编码规范、开发流程、测试指南和贡献指南，希望能够帮助开发者快速上手项目开发。

开发过程中，建议开发者：
- 严格遵循编码规范
- 编写测试用例
- 更新文档
- 参与代码审查
- 保持良好的沟通

通过共同努力，我们可以打造一个高质量、功能完善的 WordPress 后台管理优化插件。

## 11. 版本历史

| 版本号 | 更新时间 | 更新内容 | 更新人员 |
|--------|----------|----------|----------|
| 1.0.0 | 2025-11-30 | 初始版本 | Sut |

